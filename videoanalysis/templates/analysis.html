<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>유튜브콘텐츠메이커</title>
    <link rel="stylesheet" href="/static/analysis.css?v=8">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container analysis-container">
    <!-- 헤더 & 네비게이션 -->
    <header class="header">
        <h1>유튜브콘텐츠메이커</h1>
        <nav class="nav-links">
            <a href="http://127.0.0.1:8001/ytdl" class="nav-link">⬇️ 다운로드 도구</a>
            <a href="http://127.0.0.1:8001/text-removal" class="nav-link">🧽 영상에서 글자 지우기</a>
            <a href="http://127.0.0.1:8001/video-analyzer" class="nav-link">📹 영상 분석기</a>
            <a href="http://127.0.0.1:8002/" class="nav-link active">📊 영상메이커</a>
            <a href="http://127.0.0.1:8001/" class="nav-link">🏠 AI 쇼츠 메이커</a>
        </nav>
        <p class="page-description">
            다운로드된 유튜브 콘텐츠의 음성과 자막을 분석하여 완벽한 콘텐츠를 만들어보세요.
        </p>
    </header>

    <!-- 파일 탐색기 패널 -->
    <section class="panel file-explorer-panel">
        <h2>📂 파일 탐색기</h2>
        <div class="explorer-layout">
            <div class="folder-tree">
                <h3>폴더 구조</h3>
                <div class="tree-view" id="folder-tree">
                    <div class="loading">📁 폴더 구조를 불러오는 중...</div>
                </div>
            </div>
            <div class="file-list">
                <div class="file-controls">
                    <input type="text" id="file-search" placeholder="🔍 파일 검색...">
                    <select id="file-filter">
                        <option value="all">모든 파일</option>
                        <option value="video">🎬 비디오 (.webm, .mp4)</option>
                        <option value="subtitle">📝 자막 (.srt)</option>
                        <option value="audio">🎵 오디오 (.mp3, .wav)</option>
                    </select>
                    <button class="refresh-btn" id="refresh-files" title="새로고침">🔄</button>
                    <button class="file-action-btn" id="show-all-files" title="전체 파일 보이기">👁️ 전체보기</button>
                    <button class="file-action-btn" id="restore-hidden-files" title="다시 숨기기">🙈 다시숨기기</button>
                    <button class="file-action-btn danger" id="delete-hidden-files" title="숨긴 파일 삭제하기">🙈 숨김파일삭제</button>
                </div>
                <div class="file-controls" style="margin-top: 8px;">
                    <button class="file-action-btn" id="load-subtitle-from-filelist" style="background-color: #3498db;" title="자막 파일 불러오기">📋 자막 불러오기</button>
                    <button class="file-action-btn" id="load-translator-from-filelist" style="background-color: #2196F3;" title="번역기 자막 불러오기">🌐 번역기 자막 불러오기</button>
                </div>
                <div class="file-grid" id="file-grid">
                    <div class="loading">📄 파일 목록을 불러오는 중...</div>
                </div>
            </div>
        </div>
    </section>

    <!-- 선택된 파일 & 배치 옵션 -->
    <section class="panel selection-panel">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2>🎯 분석 대상</h2>
            <div>
                <button class="btn-xs" id="save-analysis-target" title="현재 선택된 파일 저장">💾 저장</button>
                <button class="btn-xs" id="load-analysis-target" title="저장된 파일 불러오기">📂 불러오기</button>
                <button class="btn-xs" id="load-subtitle-to-results" style="background-color: #3498db;" title="자막 파일 불러와서 번역 결과에 추가">📋 자막 불러오기</button>
            </div>
        </div>
        <div class="selection-layout">
            <div class="selected-files">
                <h3>선택된 파일 (<span id="selected-count">0</span>개)</h3>
                <div class="selected-list" id="selected-files-list">
                    <div class="empty-state">📋 분석할 파일을 선택하세요</div>
                </div>
            </div>
            <div class="batch-options">
                <h3>⚙️ 배치 분석 옵션</h3>
                <div class="option-group">
                    <label>
                        <input type="checkbox" id="auto-pair-files" checked>
                        🔗 관련 파일 자동 매칭 (비디오↔자막)
                    </label>
                    <label>
                        <input type="checkbox" id="parallel-processing">
                        ⚡ 병렬 처리 (빠른 분석)
                    </label>
                    <label>
                        <input type="checkbox" id="save-results" checked>
                        💾 결과 자동 저장
                    </label>
                </div>
            </div>
        </div>
    </section>

    <!-- 영상메이커 탭들 -->
    <section class="panel analysis-tools-panel">
        <h2>🔧 분석 & 편집 도구</h2>
        <div class="tool-tabs">
            <button class="tab-btn active" data-tab="audio">🎵 음성 분석</button>
            <button class="tab-btn" data-tab="subtitle">📝 자막 분석 & 편집</button>
            <button class="tab-btn" data-tab="speaker">🎭 화자 인식</button>
            <button class="tab-btn" data-tab="stt">🎤 음성→자막</button>
            <button class="tab-btn" data-tab="extract-audio">🎬 음성 추출</button>
            <button class="tab-btn" data-tab="video-edit">🎬 영상 편집</button>
            <button class="tab-btn" data-tab="text-overlay">🖊️ 텍스트 오버레이</button>
            <button class="tab-btn" data-tab="compare">⚖️ 비교 분석</button>
        </div>

        <div class="tab-contents">
            <!-- 🎵 음성 분석 탭 -->
            <div class="tab-content active" id="audio-tab">
                <div class="analysis-controls">
                    <div class="control-group">
                        <label>🔇 무음 구간 감지 임계값</label>
                        <div class="input-group">
                            <input type="range" id="silence-threshold" min="0.01" max="0.1" step="0.01" value="0.05">
                            <span class="value-display">0.05</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>⏱️ 최소 갭 길이 (초)</label>
                        <input type="number" id="min-gap" value="0.15" step="0.05" min="0.1">
                    </div>

                    <button class="analyze-btn primary" id="start-audio-analysis">🔍 음성 분석 시작</button>
                </div>

                <div class="analysis-output" id="audio-results" style="display: none;">
                    <div class="results-summary">
                        <div class="stat-card">
                            <h4>📏 총 길이</h4>
                            <span class="stat-value" id="audio-duration">-</span>
                        </div>
                        <div class="stat-card">
                            <h4>🔇 무음 구간</h4>
                            <span class="stat-value" id="silence-count">-</span>
                        </div>
                        <div class="stat-card">
                            <h4>🎤 음성 비율</h4>
                            <span class="stat-value" id="voice-percentage">-</span>
                        </div>
                    </div>

                    <div class="timeline-visualizer">
                        <h4>📊 오디오 시각화</h4>
                        <canvas id="audio-waveform-canvas" width="800" height="150"></canvas>
                    </div>

                    <div class="gap-list">
                        <h4>🎯 감지된 무음 구간</h4>
                        <div id="detected-gaps"></div>
                    </div>
                </div>
            </div>

            <!-- 📝 자막 분석 & 편집 탭 -->
            <div class="tab-content" id="subtitle-tab">
                <div class="subtitle-analysis-edit">
                    <!-- 기본 분석 정보 -->
                    <div class="analysis-section">
                        <div class="srt-info">
                            <h4>📄 SRT 파일 정보</h4>
                            <div class="info-grid">
                                <div class="info-item">
                                    <label>총 자막 수</label>
                                    <span id="subtitle-count">-</span>
                                </div>
                                <div class="info-item">
                                    <label>갭 수</label>
                                    <span id="gap-count" class="warning">-</span>
                                </div>
                                <div class="info-item">
                                    <label>겹침 수</label>
                                    <span id="overlap-count" class="error">-</span>
                                </div>
                                <div class="info-item">
                                    <label>총 길이</label>
                                    <span id="subtitle-duration">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="analysis-actions">
                            <button class="analysis-btn" id="analyze-srt">🔍 상세 분석</button>
                            <button class="analysis-btn" id="compare-with-audio">🎵 음성과 비교</button>
                            <button class="analysis-btn" id="export-analysis">📊 분석 결과 내보내기</button>
                        </div>
                    </div>

                    <!-- 고급 편집 기능 -->
                    <div class="editing-section" style="display: none;" id="subtitle-editing-tools">
                        <h4>🛠️ 자막 편집 도구</h4>

                        <!-- 타임라인 시각화 및 편집 -->
                        <div class="timeline-editor">
                            <h5>📊 자막 타임라인 편집기</h5>
                            <div class="timeline-container">
                                <div class="timeline-header" id="timeline-header">
                                    <!-- 시간 마커들이 동적으로 생성됨 -->
                                </div>
                                <div class="timeline-track" id="subtitle-timeline-track">
                                    <!-- 자막 블록들이 여기에 표시됨 -->
                                </div>
                                <div class="timeline-controls">
                                    <button class="timeline-btn" id="zoom-in">🔍 확대</button>
                                    <button class="timeline-btn" id="zoom-out">🔍 축소</button>
                                    <button class="timeline-btn" id="play-timeline">▶️ 재생</button>
                                    <input type="range" id="timeline-cursor" min="0" max="100" value="0">
                                </div>
                            </div>
                        </div>

                        <!-- 겹침/갭 해결 도구 -->
                        <div class="overlap-gap-tools">
                            <h5>⚡ 자동 수정 도구</h5>
                            <div class="auto-fix-controls">
                                <div class="fix-option">
                                    <label>
                                        <input type="checkbox" id="fix-overlaps" checked>
                                        🔄 겹침 자동 해결
                                    </label>
                                    <div class="fix-settings">
                                        <label>간격: <input type="number" id="overlap-gap" value="0.1" step="0.1" min="0">초</label>
                                    </div>
                                </div>

                                <div class="fix-option">
                                    <label>
                                        <input type="checkbox" id="fill-gaps">
                                        📏 갭 자동 채우기
                                    </label>
                                    <div class="fix-settings">
                                        <label>최대 갭: <input type="number" id="max-gap-fill" value="0.5" step="0.1">초</label>
                                    </div>
                                </div>

                                <button class="apply-fixes-btn" id="apply-all-fixes">🔧 자동 수정 적용</button>
                            </div>
                        </div>

                        <!-- 개별 자막 편집 -->
                        <div class="individual-edit">
                            <h5>✏️ 개별 자막 편집</h5>
                            <div class="subtitle-editor">
                                <div class="subtitle-list" id="editable-subtitle-list">
                                    <!-- 편집 가능한 자막 목록 -->
                                </div>
                                <div class="edit-controls">
                                    <button class="edit-btn" id="add-subtitle">➕ 자막 추가</button>
                                    <button class="edit-btn" id="split-subtitle">✂️ 자막 분할</button>
                                    <button class="edit-btn" id="merge-subtitles">🔗 자막 병합</button>
                                    <button class="edit-btn" id="delete-subtitle">🗑️ 자막 삭제</button>
                                </div>
                            </div>
                        </div>

                        <!-- 재해석 비교 편집 패널 -->
                        <div class="reinterpretation-compare" id="reinterpretation-compare" style="display: none;">
                            <h5>📝 재해석 비교 편집</h5>
                            <p class="compare-hint">타임라인에서 설명 자막을 선택하면 재해석 전후 내용을 비교하고 수정할 수 있습니다.</p>
                            <div class="compare-grid">
                                <div class="compare-column">
                                    <label>변경 전</label>
                                    <div class="compare-before" id="reinterpretation-before-text"></div>
                                </div>
                                <div class="compare-column">
                                    <label for="reinterpretation-after-input">변경 후</label>
                                    <textarea id="reinterpretation-after-input" class="compare-after-input" spellcheck="false"></textarea>
                                </div>
                            </div>
                            <div class="compare-meta" id="reinterpretation-meta"></div>
                            <div class="compare-actions">
                                <button class="action-btn primary" id="reinterpretation-apply-button">✅ 타임라인에 적용</button>
                                <button class="action-btn secondary" id="reinterpretation-revert-button">↩️ 원본으로 복원</button>
                            </div>
                        </div>
                    </div>

                    <!-- 권장사항 -->
                    <div class="recommendations">
                        <h4>💡 개선 권장사항</h4>
                        <ul class="recommendation-list" id="subtitle-recommendations">
                            <!-- 권장사항들이 동적으로 추가됨 -->
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 🎭 화자 인식 탭 -->
            <div class="tab-content" id="speaker-tab">
                <div class="speaker-recognition-section">
                    <h3>🎭 화자 인식 및 트랙 배치</h3>

                    <!-- 화자 인식 방법 선택 -->
                    <div class="recognition-method">
                        <h4>🔍 인식 방법 선택</h4>
                        <div class="method-options">
                            <label class="method-option">
                                <input type="radio" name="recognition-method" value="text" checked>
                                <div class="method-info">
                                    <strong>📝 텍스트 기반</strong>
                                    <span>자막 텍스트의 패턴과 말투를 분석하여 화자를 구분</span>
                                </div>
                            </label>
                            <label class="method-option">
                                <input type="radio" name="recognition-method" value="audio">
                                <div class="method-info">
                                    <strong>🎵 음성 기반</strong>
                                    <span>음성의 주파수, 피치, 톤을 분석하여 화자를 구분 (더 정확)</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- 화자 인식 시작 -->
                    <div class="speaker-controls">
                        <button class="analyze-btn primary" id="start-speaker-recognition">🎭 화자 인식 시작</button>
                        <button class="action-btn secondary" id="load-saved-speaker-main">💾 불러오기</button>
                        <div class="speaker-help">
                            💡 선택한 방법으로 등장인물을 자동 감지하고 각각을 다른 트랙에 배치합니다
                        </div>
                        <div class="saved-speaker-controls">
                            <label>저장된 프로필
                                <select id="saved-speaker-dropdown">
                                    <option value="">자동 저장 (최근)</option>
                                </select>
                            </label>
                            <div class="saved-speaker-actions">
                                <button class="action-btn secondary" id="save-speaker-profile">💾 저장</button>
                                <button class="action-btn secondary" id="rename-speaker-profile" disabled>✏️ 이름 변경</button>
                                <button class="action-btn secondary danger" id="delete-speaker-profile" disabled>🗑️ 삭제</button>
                            </div>
                        </div>
                    </div>

                    <!-- 감지된 화자 목록 -->
                    <div class="detected-speakers" id="detected-speakers" style="display: none;">
                        <h4>🎯 감지된 화자들</h4>
                        <div class="speakers-grid" id="speakers-grid">
                            <!-- 화자들이 동적으로 추가됨 -->
                        </div>
                    </div>

                    <!-- 화자-트랙 매핑 설정 -->
                    <div class="speaker-track-mapping" id="speaker-track-mapping" style="display: none;">
                        <h4>🎚️ 트랙 할당 설정</h4>
                        <div class="mapping-controls">
                            <div class="mapping-grid" id="mapping-grid">
                                <!-- 매핑 컨트롤들이 동적으로 추가됨 -->
                            </div>
                        </div>
                    </div>

                    <!-- 결과 미리보기 -->
                    <div class="mapping-results" id="mapping-results" style="display: none;">
                        <h4>📊 배치 결과</h4>
                        <div class="track-preview">
                            <div class="track-summary" id="track-summary">
                                <!-- 트랙별 자막 수 요약이 표시됨 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 🎤 음성→자막 탭 -->
            <div class="tab-content" id="stt-tab">
                <div class="stt-controls">
                    <div class="setting-group">
                        <label>🌐 인식 언어</label>
                        <select id="stt-language">
                            <option value="ko-KR">🇰🇷 한국어</option>
                            <option value="en-US">🇺🇸 English</option>
                            <option value="ja-JP">🇯🇵 日本語</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label>✂️ 분할 단위 (초)</label>
                        <input type="number" id="segment-duration" value="5" min="1" max="10">
                    </div>

                    <button class="analyze-btn primary" id="start-stt">🎤 음성 인식 시작</button>
                </div>

                <div class="stt-progress" id="stt-progress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="stt-progress-fill" style="width: 0%"></div>
                    </div>
                    <span class="progress-text" id="stt-progress-text">대기 중...</span>
                </div>

                <div class="stt-results" id="stt-results" style="display: none;">
                    <div class="result-header">
                        <h4>📄 생성된 SRT</h4>
                        <div class="result-actions">
                            <button class="action-btn" id="download-srt">📥 다운로드</button>
                            <button class="action-btn" id="open-in-timeline">🎬 타임라인 편집기로</button>
                        </div>
                    </div>

                    <div class="srt-preview">
                        <pre class="srt-content" id="generated-srt-content"></pre>
                    </div>

                    <div class="accuracy-info">
                        <span class="accuracy-badge" id="recognition-accuracy">🎯 인식률: -%</span>
                        <span class="segments-badge" id="recognition-segments">📊 -/- 구간 성공</span>
                    </div>
                </div>
            </div>

            <!-- 🎬 음성 추출 탭 -->
            <div class="tab-content" id="extract-audio-tab">
                <div class="extract-audio-controls">
                    <div class="info-section">
                        <h4>🎵 영상에서 음성 파일 분리</h4>
                        <p>선택된 영상 파일들에서 음성을 추출하여 별도의 음성 파일로 저장합니다.</p>
                    </div>

                    <div class="setting-group">
                        <label>🎼 출력 형식</label>
                        <select id="audio-output-format">
                            <option value="wav">WAV (고품질, 무손실)</option>
                            <option value="mp3">MP3 (압축, 호환성)</option>
                            <option value="m4a">M4A (효율적 압축)</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label>📊 품질 설정</label>
                        <div class="quality-info">
                            <span class="quality-item">📈 샘플레이트: 48kHz</span>
                            <span class="quality-item">🔊 채널: 스테레오</span>
                            <span class="quality-item">💿 비트레이트: 192kbps (MP3/M4A)</span>
                        </div>
                    </div>

                    <button class="analyze-btn primary" id="start-audio-extraction">🎵 음성 추출 시작</button>
                </div>

                <div class="extraction-progress" id="extraction-progress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="extraction-progress-fill" style="width: 0%"></div>
                    </div>
                    <span class="progress-text" id="extraction-progress-text">대기 중...</span>
                </div>

                <div class="extraction-results" id="extraction-results" style="display: none;">
                    <div class="result-header">
                        <h4>🎵 추출된 음성 파일</h4>
                        <div class="result-actions">
                            <button class="action-btn" id="refresh-file-list">🔄 파일 목록 새로고침</button>
                            <button class="action-btn" id="open-extracted-folder">📁 폴더 열기</button>
                        </div>
                    </div>

                    <div class="extracted-files-list" id="extracted-files-list">
                        <!-- 추출된 파일 목록이 여기에 표시됩니다 -->
                    </div>
                </div>
            </div>

            <!-- 🎬 영상 편집 탭 -->
            <div class="tab-content" id="video-edit-tab">
                <div class="video-edit-controls">
                    <div class="control-section">
                        <div class="video-editor-heading">
                            <h4>🎥 고급 영상 편집기</h4>
                        </div>

                        <div class="title-subtitle-controls">
                            <div class="video-title-controls title-controls-grid">
                                <div class="title-input-group">
                                    <label for="video-title-input">제목</label>
                                    <input type="text" id="video-title-input" placeholder="영상 제목을 입력하세요">
                                </div>
                                <div class="title-size-control">
                                    <label for="video-title-size">크기</label>
                                    <input type="range" id="video-title-size" min="24" max="120" value="48" step="2">
                                    <span class="title-size-value" id="video-title-size-display">48px</span>
                                </div>
                                <div class="title-color-control">
                                    <label for="video-title-color">색상</label>
                                    <input type="color" id="video-title-color" value="#000000">
                                </div>
                                <div class="title-motion-control">
                                    <label for="video-title-motion">모션</label>
                                    <select id="video-title-motion">
                                        <option value="none">효과 없음</option>
                                        <option value="fade">페이드 인</option>
                                        <option value="slide-up">슬라이드 업</option>
                                        <option value="slide-down">슬라이드 다운</option>
                                        <option value="slide-left">슬라이드 좌</option>
                                        <option value="slide-right">슬라이드 우</option>
                                        <option value="zoom-in">줌 인</option>
                                        <option value="zoom-out">줌 아웃</option>
                                        <option value="bounce">바운스</option>
                                        <option value="rotate">회전</option>
                                        <option value="pulse">펄스</option>
                                    </select>
                                </div>
                                <div class="title-effect-group">
                                    <span class="effect-label">🎨 텍스트 효과</span>
                                    <label class="effect-option">
                                        <input type="checkbox" id="video-title-outline" checked>
                                        <span>정적 효과 (외곽선)</span>
                                    </label>
                                    <label class="effect-option">
                                        <input type="checkbox" id="video-title-dynamic">
                                        <span>동적 효과 (모션)</span>
                                    </label>
                                </div>
                            </div>

                            <div class="subtitle-controls-grid">
                                <div class="subtitle-input-group">
                                    <label for="video-subtitle-input">부제목</label>
                                    <input type="text" id="video-subtitle-input" placeholder="부제목을 입력하세요">
                                </div>
                                <div class="subtitle-size-control">
                                    <label for="video-subtitle-size">크기</label>
                                    <input type="range" id="video-subtitle-size" min="20" max="96" value="32" step="2">
                                    <span class="subtitle-size-value" id="video-subtitle-size-display">32px</span>
                                </div>
                                <div class="subtitle-color-control">
                                    <label for="video-subtitle-color">색상</label>
                                    <input type="color" id="video-subtitle-color" value="#000000">
                                </div>
                                <div class="subtitle-motion-control">
                                    <label for="video-subtitle-motion">모션</label>
                                    <select id="video-subtitle-motion">
                                        <option value="none">효과 없음</option>
                                        <option value="fade">페이드 인</option>
                                        <option value="slide-up">슬라이드 업</option>
                                        <option value="slide-down">슬라이드 다운</option>
                                        <option value="slide-left">슬라이드 좌</option>
                                        <option value="slide-right">슬라이드 우</option>
                                        <option value="zoom-in">줌 인</option>
                                        <option value="zoom-out">줌 아웃</option>
                                        <option value="bounce">바운스</option>
                                        <option value="rotate">회전</option>
                                        <option value="pulse">펄스</option>
                                    </select>
                                </div>
                                <div class="subtitle-effect-group">
                                    <span class="effect-label">🎨 텍스트 효과</span>
                                    <label class="effect-option">
                                        <input type="checkbox" id="video-subtitle-outline" checked>
                                        <span>정적 효과 (외곽선)</span>
                                    </label>
                                    <label class="effect-option">
                                        <input type="checkbox" id="video-subtitle-dynamic">
                                        <span>동적 효과 (모션)</span>
                                    </label>
                                </div>
                            </div>

                            <div class="text-effects-control">
                                <h4 class="area-title">🎨 텍스트 효과</h4>
                                <div class="effects-controls">
                                    <div class="control-group">
                                        <label class="control-label" for="static-effect">정적 효과 (스타일)</label>
                                        <select id="static-effect" class="control-select">
                                            <option value="none">없음</option>
                                            <option value="outline">외곽선</option>
                                            <option value="shadow">그림자</option>
                                            <option value="glow">글로우</option>
                                            <option value="gradient">그라데이션</option>
                                            <option value="neon">네온</option>
                                        </select>
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label" for="dynamic-effect">동적 효과 (모션)</label>
                                        <select id="dynamic-effect" class="control-select">
                                            <option value="none">없음</option>
                                            <option value="typewriter">타이핑</option>
                                            <option value="wave">웨이브</option>
                                            <option value="pulse">펄스</option>
                                            <option value="shake">떨림</option>
                                            <option value="fade">페이드</option>
                                            <option value="bounce">바운스</option>
                                            <option value="flip">플립</option>
                                            <option value="slide">슬라이드</option>
                                            <option value="zoom">줌</option>
                                            <option value="rotate">회전</option>
                                            <option value="glitch">글리치</option>
                                            <option value="matrix">매트릭스</option>
                                            <option value="fire">불꽃</option>
                                            <option value="rainbow">무지개</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="text-style-presets">
                                <h4 class="area-title">💾 스타일 프리셋</h4>
                                <div class="preset-input-row">
                                    <input type="text" id="text-style-preset-name" placeholder="프리셋 이름을 입력하세요">
                                    <button type="button" id="save-text-style-preset">저장</button>
                                </div>
                                <div class="preset-manage-row">
                                    <select id="text-style-preset-select">
                                        <option value="">저장된 프리셋 선택</option>
                                    </select>
                                    <button type="button" id="apply-text-style-preset" disabled>불러오기</button>
                                    <button type="button" id="delete-text-style-preset" disabled>삭제</button>
                                </div>
                                <p class="preset-hint">프리셋에는 제목·부제목의 텍스트, 크기, 색상, 모션, 위치, 효과 설정이 함께 저장됩니다.</p>
                            </div>
                        </div>

                        <div class="realtime-style-controls">
                            <h4 class="area-title">📝 실시간 자막 스타일</h4>
                            <div class="realtime-style-grid">
                                <div class="realtime-style-group">
                                    <h5>메인 자막</h5>
                                    <div class="realtime-control-group">
                                        <label for="realtime-main-size">크기</label>
                                        <div class="range-with-value">
                                            <input type="range" id="realtime-main-size" min="18" max="96" value="36" step="1">
                                            <span class="realtime-size-value" id="realtime-main-size-display">36px</span>
                                        </div>
                                    </div>
                                    <div class="realtime-control-group">
                                        <label for="realtime-main-color">색상</label>
                                        <input type="color" id="realtime-main-color" value="#000000">
                                    </div>
                                    <div class="realtime-control-group">
                                        <label for="realtime-main-static-effect">정적 효과 (스타일)</label>
                                        <select id="realtime-main-static-effect" class="control-select">
                                            <option value="none">없음</option>
                                            <option value="outline">외곽선</option>
                                            <option value="shadow">그림자</option>
                                            <option value="glow">글로우</option>
                                            <option value="gradient">그라데이션</option>
                                            <option value="neon">네온</option>
                                        </select>
                                    </div>
                                    <div class="realtime-effect-options">
                                        <label class="effect-option">
                                            <input type="checkbox" id="realtime-main-outline">
                                            <span>정적 효과 (외곽선)</span>
                                        </label>
                                        <label class="effect-option">
                                            <input type="checkbox" id="realtime-main-dynamic">
                                            <span>동적 효과 (모션)</span>
                                        </label>
                                    </div>
                                    <div class="realtime-control-group">
                                        <label for="realtime-main-dynamic-effect">동적 효과 (모션)</label>
                                        <select id="realtime-main-dynamic-effect" class="control-select">
                                            <option value="none">없음</option>
                                            <option value="typewriter">타이핑</option>
                                            <option value="wave">웨이브</option>
                                            <option value="pulse">펄스</option>
                                            <option value="shake">떨림</option>
                                            <option value="fade">페이드</option>
                                            <option value="bounce">바운스</option>
                                            <option value="flip">플립</option>
                                            <option value="slide">슬라이드</option>
                                            <option value="zoom">줌</option>
                                            <option value="rotate">회전</option>
                                            <option value="glitch">글리치</option>
                                            <option value="matrix">매트릭스</option>
                                            <option value="fire">불꽃</option>
                                            <option value="rainbow">무지개</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="realtime-style-group">
                                    <h5>설명 자막</h5>
                                    <div class="realtime-control-group">
                                        <label for="realtime-description-size">크기</label>
                                        <div class="range-with-value">
                                            <input type="range" id="realtime-description-size" min="18" max="96" value="32" step="1">
                                            <span class="realtime-size-value" id="realtime-description-size-display">32px</span>
                                        </div>
                                    </div>
                                    <div class="realtime-control-group">
                                        <label for="realtime-description-color">색상</label>
                                        <input type="color" id="realtime-description-color" value="#000000">
                                    </div>
                                    <div class="realtime-control-group">
                                        <label for="realtime-description-static-effect">정적 효과 (스타일)</label>
                                        <select id="realtime-description-static-effect" class="control-select">
                                            <option value="none">없음</option>
                                            <option value="outline">외곽선</option>
                                            <option value="shadow">그림자</option>
                                            <option value="glow">글로우</option>
                                            <option value="gradient">그라데이션</option>
                                            <option value="neon">네온</option>
                                        </select>
                                    </div>
                                    <div class="realtime-effect-options">
                                        <label class="effect-option">
                                            <input type="checkbox" id="realtime-description-outline">
                                            <span>정적 효과 (외곽선)</span>
                                        </label>
                                        <label class="effect-option">
                                            <input type="checkbox" id="realtime-description-dynamic">
                                            <span>동적 효과 (모션)</span>
                                        </label>
                                    </div>
                                    <div class="realtime-control-group">
                                        <label for="realtime-description-dynamic-effect">동적 효과 (모션)</label>
                                        <select id="realtime-description-dynamic-effect" class="control-select">
                                            <option value="none">없음</option>
                                            <option value="typewriter">타이핑</option>
                                            <option value="wave">웨이브</option>
                                            <option value="pulse">펄스</option>
                                            <option value="shake">떨림</option>
                                            <option value="fade">페이드</option>
                                            <option value="bounce">바운스</option>
                                            <option value="flip">플립</option>
                                            <option value="slide">슬라이드</option>
                                            <option value="zoom">줌</option>
                                            <option value="rotate">회전</option>
                                            <option value="glitch">글리치</option>
                                            <option value="matrix">매트릭스</option>
                                            <option value="fire">불꽃</option>
                                            <option value="rainbow">무지개</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 자막 입력 섹션 (한글/영어) -->
                        <div class="custom-subtitles-section">
                            <h4 class="area-title">📝 자막 추가 (한글/영어)</h4>
                            <div class="subtitles-input-grid">
                                <!-- 한글 자막 -->
                                <div class="subtitle-input-card">
                                    <h5>🇰🇷 한글 자막</h5>
                                    <div class="subtitle-input-controls">
                                        <textarea id="korean-subtitle-input" placeholder="한글 자막을 입력하세요..." rows="3"></textarea>
                                        <div class="subtitle-style-row">
                                            <div class="control-item">
                                                <label for="korean-subtitle-size">크기</label>
                                                <input type="range" id="korean-subtitle-size" min="18" max="96" value="32" step="2">
                                                <span class="size-value" id="korean-subtitle-size-display">32px</span>
                                            </div>
                                            <div class="control-item">
                                                <label for="korean-subtitle-color">색상</label>
                                                <input type="color" id="korean-subtitle-color" value="#000000">
                                            </div>
                                        </div>
                                        <div class="subtitle-position-row">
                                            <div class="control-item">
                                                <label for="korean-subtitle-x">X 위치</label>
                                                <input type="number" id="korean-subtitle-x" value="50" min="0" max="100" step="1">
                                                <span>%</span>
                                            </div>
                                            <div class="control-item">
                                                <label for="korean-subtitle-y">Y 위치</label>
                                                <input type="number" id="korean-subtitle-y" value="80" min="0" max="100" step="1">
                                                <span>%</span>
                                            </div>
                                        </div>
                                        <div class="subtitle-effect-row">
                                            <div class="control-item">
                                                <label for="korean-subtitle-effect">효과</label>
                                                <select id="korean-subtitle-effect">
                                                    <option value="none">없음</option>
                                                    <option value="outline" selected>외곽선</option>
                                                    <option value="shadow">그림자</option>
                                                    <option value="glow">글로우</option>
                                                    <option value="fade">페이드</option>
                                                    <option value="slide-up">슬라이드 업</option>
                                                </select>
                                            </div>
                                        </div>
                                        <button class="apply-subtitle-btn" id="apply-korean-subtitle">✅ 한글 자막 적용</button>
                                    </div>
                                </div>

                                <!-- 영어 자막 -->
                                <div class="subtitle-input-card">
                                    <h5>🇺🇸 영어 자막</h5>
                                    <div class="subtitle-input-controls">
                                        <textarea id="english-subtitle-input" placeholder="Enter English subtitle..." rows="3"></textarea>
                                        <div class="subtitle-style-row">
                                            <div class="control-item">
                                                <label for="english-subtitle-size">크기</label>
                                                <input type="range" id="english-subtitle-size" min="18" max="96" value="28" step="2">
                                                <span class="size-value" id="english-subtitle-size-display">28px</span>
                                            </div>
                                            <div class="control-item">
                                                <label for="english-subtitle-color">색상</label>
                                                <input type="color" id="english-subtitle-color" value="#000000">
                                            </div>
                                        </div>
                                        <div class="subtitle-position-row">
                                            <div class="control-item">
                                                <label for="english-subtitle-x">X 위치</label>
                                                <input type="number" id="english-subtitle-x" value="50" min="0" max="100" step="1">
                                                <span>%</span>
                                            </div>
                                            <div class="control-item">
                                                <label for="english-subtitle-y">Y 위치</label>
                                                <input type="number" id="english-subtitle-y" value="90" min="0" max="100" step="1">
                                                <span>%</span>
                                            </div>
                                        </div>
                                        <div class="subtitle-effect-row">
                                            <div class="control-item">
                                                <label for="english-subtitle-effect">효과</label>
                                                <select id="english-subtitle-effect">
                                                    <option value="none">없음</option>
                                                    <option value="outline" selected>외곽선</option>
                                                    <option value="shadow">그림자</option>
                                                    <option value="glow">글로우</option>
                                                    <option value="fade">페이드</option>
                                                    <option value="slide-up">슬라이드 업</option>
                                                </select>
                                            </div>
                                        </div>
                                        <button class="apply-subtitle-btn" id="apply-english-subtitle">✅ 영어 자막 적용</button>
                                    </div>
                                </div>
                            </div>

                            <!-- 자막 설정 저장/불러오기 -->
                            <div class="subtitle-preset-controls">
                                <h5 class="preset-title">💾 자막 설정 저장/불러오기</h5>
                                <div class="preset-actions">
                                    <input type="text" id="subtitle-preset-name" placeholder="설정 이름 입력" class="preset-name-input">
                                    <button class="preset-btn save" id="save-subtitle-preset">💾 저장</button>
                                    <select id="subtitle-preset-select" class="preset-select">
                                        <option value="">저장된 설정 선택</option>
                                    </select>
                                    <button class="preset-btn load" id="load-subtitle-preset">📂 불러오기</button>
                                    <button class="preset-btn delete" id="delete-subtitle-preset">🗑️ 삭제</button>
                                </div>
                                <p class="preset-hint">💡 자막 텍스트, 크기, 색상, 위치, 효과를 저장하고 불러올 수 있습니다.</p>
                            </div>
                        </div>

                        <!-- 비디오 플레이어 -->
                        <div class="video-subtitle-wrapper">
                            <div class="video-player-container">
                                <video id="video-player" controls style="width: 100%; max-width: 800px;" crossorigin="anonymous">
                                    <source src="" type="video/webm">
                                    <source src="" type="video/mp4">
                                    비디오를 불러올 수 없습니다.
                                </video>
                            </div>

                            <div class="video-title-overlay video-text-overlay empty" id="video-title-overlay">
                                영상 제목
                            </div>

                            <div class="video-subtitle-overlay video-text-overlay empty" id="video-subtitle-overlay">
                                영상 부제목
                            </div>

                            <div class="subtitle-line-overlay subtitle-line-overlay-main empty" id="overlay-main-subtitle"></div>
                            <div class="subtitle-line-overlay subtitle-line-overlay-description empty" id="overlay-description-subtitle"></div>

                            <!-- 커스텀 자막 오버레이 (한글/영어) -->
                            <div class="custom-subtitle-overlay empty" id="korean-subtitle-overlay" data-lang="korean">
                                한글 자막
                            </div>
                            <div class="custom-subtitle-overlay empty" id="english-subtitle-overlay" data-lang="english">
                                English Subtitle
                            </div>
                        </div>

                        <!-- 오디오 플레이어 (음성만 로드 시 사용) -->
                        <div class="audio-player-container" style="display: none;">
                            <h4>🎵 음성 플레이어</h4>
                            <audio id="audio-player" controls style="width: 100%; max-width: 800px;" crossorigin="anonymous">
                                <source src="" type="audio/wav">
                                <source src="" type="audio/mp3">
                                <source src="" type="audio/mpeg">
                                오디오를 불러올 수 없습니다.
                            </audio>
                        </div>

                        <!-- 타임라인 편집기 -->
                        <div class="timeline-editor">
                            <div class="timeline-controls">
                                <div class="playback-controls">
                                    <button id="play-pause-btn">⏯️</button>
                                    <button id="stop-btn">⏹️</button>
                                    <button id="rewind-btn">⏪</button>
                                    <button id="forward-btn">⏩</button>
                                    <button id="skip-to-start-btn" title="맨 처음으로">⏮️</button>
                                    <button id="skip-to-end-btn" title="맨 끝으로">⏭️</button>
                                </div>

                                <div class="zoom-controls">
                                    <label>🔍 타임라인 확대/축소:</label>
                                    <input type="range" id="timeline-zoom" min="1" max="20" value="1" step="0.5">
                                    <span id="zoom-display">1x</span>
                                    <button id="fit-to-subtitles">📝 자막에 맞춤</button>
                                </div>

                                <div class="time-display">
                                    <span id="current-time">00:00</span> / <span id="total-time">00:00</span>
                                </div>
                            </div>

                            <!-- 스크롤 가능한 타임라인 컨테이너 -->
                            <div class="timeline-container" id="timeline-container">
                                <div class="timeline-content" id="timeline-content">

                                    <!-- 시간 눈금자 -->
                                    <div class="timeline-ruler" id="timeline-ruler">
                                        <!-- 시간 마커들이 여기에 동적으로 생성됩니다 -->
                                    </div>

                                    <!-- 영상 트랙 -->
                                    <div class="timeline-track video-track">
                                        <div class="track-header" style="display: flex; align-items: center; gap: 10px;">
                                            <input type="checkbox" id="track-video-enable" checked style="cursor: pointer; width: 18px; height: 18px;">
                                            <label for="track-video-enable" style="cursor: pointer;">📹 영상</label>
                                            <button id="video-mute-btn" style="background: none; border: none; cursor: pointer; font-size: 20px; padding: 0; margin-left: auto;" title="영상 음소거/해제">🔊</button>
                                        </div>
                                        <div class="track-content" id="video-track">
                                            <!-- 영상 클립이 여기에 표시됩니다 -->
                                        </div>
                                    </div>

                                    <!-- 음성 파형 트랙 -->
                                    <div class="timeline-track audio-track">
                                        <div class="track-header" style="display: flex; align-items: center; gap: 10px;">
                                            <input type="checkbox" id="track-audio-enable" checked style="cursor: pointer; width: 18px; height: 18px;">
                                            <label for="track-audio-enable" style="cursor: pointer;">🎵 음성</label>
                                        </div>
                                        <div class="track-content" id="audio-track">
                                            <canvas id="timeline-waveform" height="50"></canvas>
                                        </div>
                                    </div>

                                    <!-- 해설 음성 파형 트랙 -->
                                    <div class="timeline-track audio-track">
                                        <div class="track-header" style="display: flex; align-items: center; gap: 10px;">
                                            <input type="checkbox" id="track-commentary-enable" checked style="cursor: pointer; width: 18px; height: 18px;">
                                            <label for="track-commentary-enable" style="cursor: pointer;">🎙️ 해설 음성</label>
                                        </div>
                                        <div class="track-content" id="commentary-audio-track">
                                            <canvas id="commentary-waveform" height="50"></canvas>
                                        </div>
                                    </div>

                                    <!-- 배경 음악 파형 트랙 -->
                                    <div class="timeline-track audio-track">
                                        <div class="track-header" style="display: flex; align-items: center; gap: 10px;">
                                            <input type="checkbox" id="track-bgm-enable" checked style="cursor: pointer; width: 18px; height: 18px;">
                                            <label for="track-bgm-enable" style="cursor: pointer;">🎵 배경 음악</label>
                                        </div>
                                        <div class="track-content" id="bgm-audio-track">
                                            <canvas id="bgm-waveform" height="50"></canvas>
                                        </div>
                                    </div>

                                    <!-- 하이브리드 자막 트랙 시스템 -->
                                    <!-- 메인 자막 트랙 (원어 대사) -->
                                    <div class="timeline-track subtitle-track main-subtitle-track" id="main-subtitle-track">
                                        <div class="track-header">
                                            <div class="track-title" style="display: flex; align-items: center; gap: 8px;">
                                                <input type="checkbox" id="track-main-subtitle-enable" checked style="cursor: pointer; width: 16px; height: 16px;">
                                                <label for="track-main-subtitle-enable" style="cursor: pointer;">📝 메인 자막</label>
                                            </div>
                                            <div class="track-controls">
                                                <button class="track-toggle" data-track="main" title="표시/숨김">👁️</button>
                                                <button class="track-lock" data-track="main" title="잠금/해제">🔓</button>
                                                <button class="track-settings" data-track="main" title="설정">⚙️</button>
                                            </div>
                                        </div>
                                        <div class="track-content" id="main-subtitle-content">
                                            <!-- 메인 자막 블록들이 여기에 표시됩니다 -->
                                        </div>
                                    </div>

                                    <!-- 번역/더빙 자막 트랙 -->
                                    <div class="timeline-track subtitle-track translation-subtitle-track" id="translation-subtitle-track">
                                        <div class="track-header">
                                            <div class="track-title" style="display: flex; align-items: center; gap: 8px;">
                                                <input type="checkbox" id="track-translation-subtitle-enable" checked style="cursor: pointer; width: 16px; height: 16px;">
                                                <label for="track-translation-subtitle-enable" style="cursor: pointer;">🌐 번역 자막</label>
                                            </div>
                                            <div class="track-controls">
                                                <button class="track-toggle" data-track="translation" title="표시/숨김">👁️</button>
                                                <button class="track-lock" data-track="translation" title="잠금/해제">🔓</button>
                                                <button class="track-settings" data-track="translation" title="설정">⚙️</button>
                                            </div>
                                        </div>
                                        <div class="track-content" id="translation-subtitle-content">
                                            <!-- 번역 자막 블록들이 여기에 표시됩니다 -->
                                        </div>
                                    </div>

                                    <!-- 설명/효과음 자막 트랙 -->
                                    <div class="timeline-track subtitle-track description-subtitle-track" id="description-subtitle-track">
                                        <div class="track-header">
                                            <div class="track-title" style="display: flex; align-items: center; gap: 8px;">
                                                <input type="checkbox" id="track-description-subtitle-enable" checked style="cursor: pointer; width: 16px; height: 16px;">
                                                <label for="track-description-subtitle-enable" style="cursor: pointer;">🔊 설명 자막</label>
                                            </div>
                                            <div class="track-controls">
                                                <button class="track-toggle" data-track="description" title="표시/숨김">👁️</button>
                                                <button class="track-lock" data-track="description" title="잠금/해제">🔓</button>
                                                <button class="track-settings" data-track="description" title="설정">⚙️</button>
                                            </div>
                                        </div>
                                        <div class="track-content" id="description-subtitle-content">
                                            <!-- 설명 자막 블록들이 여기에 표시됩니다 -->
                                        </div>
                                    </div>

                                    <!-- 재생 헤드 -->
                                    <div class="playhead" id="playhead"></div>
                                </div>
                            </div>
                        </div>

                        <div class="sync-controls">
                            <button class="sync-btn" id="load-video-file">📹 영상 파일 로드</button>
                            <button class="sync-btn" id="load-audio-file">🎵 음성 파일 로드</button>
                            <button class="sync-btn" id="load-bgm-file">🎵 배경음악 로드</button>
                            <button class="sync-btn" id="load-subtitle-file">📝 자막 파일 로드</button>
                            <button class="sync-btn" id="load-saved-title-as-subtitle" style="background-color: #9C27B0; color: white;">📺 저장된 제목 불러오기</button>
                            <button class="sync-btn" id="load-translator-subtitles" style="background-color: #2196F3;">🌐 유튜브제작기 번역결과 자막 로드</button>
                            <button class="sync-btn" id="load-translator-audio" style="background-color: #2196F3;">🎵 유튜브제작기 번역결과 음성 로드</button>
                            <button class="sync-btn" id="cut-translation-audio" style="background-color: #FF5722;">🔇 설명자막 음성 묵음처리</button>
                            <button class="sync-btn primary" id="simultaneous-play">🎥 영상+음성 동시 재생</button>
                            <button class="sync-btn secondary" id="bundle-audio">🎵 음성 묶음 편집</button>
                        </div>

                        <!-- 영상 출력 제목 입력 -->
                        <div style="margin: 15px 0; padding: 15px; background: #1a2332; border-radius: 8px; border: 1px solid #2a3f5f;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <label for="output-video-title" style="color: #f0f4f8; font-weight: bold;">
                                    📝 출력 영상 제목 (나중에 자막으로 사용 가능)
                                </label>
                                <div style="display: flex; gap: 5px;">
                                    <button id="load-title-preset" class="sync-btn" style="padding: 5px 12px; font-size: 12px; background: #9C27B0;">
                                        📚 프리셋 불러오기
                                    </button>
                                    <button id="save-title-preset" class="sync-btn" style="padding: 5px 12px; font-size: 12px; background: #FF9800;">
                                        💾 프리셋 저장
                                    </button>
                                    <button id="auto-fill-titles" class="sync-btn" style="padding: 5px 12px; font-size: 12px; background: #4CAF50;">
                                        🔄 선택된 파일 제목 채우기
                                    </button>
                                </div>
                            </div>
                            <input type="text" id="output-video-title" placeholder="예: 놀라운 AI 기술의 세계"
                                   style="width: 100%; padding: 10px; background: #0d1520; color: #f0f4f8; border: 1px solid #2a3f5f; border-radius: 5px; font-size: 14px; margin-bottom: 10px;">

                            <!-- 개별 파일 제목 목록 -->
                            <div id="selected-files-titles" style="display: none; margin-top: 10px; padding: 10px; background: #0d1520; border-radius: 5px; border: 1px solid #2a3f5f;">
                                <div style="color: #4ade80; font-weight: bold; margin-bottom: 8px;">📋 선택된 파일 제목 목록:</div>
                                <div id="files-titles-list" style="color: #b0c4d0; font-size: 13px;"></div>
                                <div id="files-duration-info" style="color: #667eea; font-size: 12px; margin-top: 8px; padding-top: 8px; border-top: 1px solid #2a3f5f;"></div>
                            </div>

                            <!-- 자막 스타일 옵션 -->
                            <div style="margin-top: 10px;">
                                <label style="color: #f0f4f8; font-size: 13px; display: block; margin-bottom: 5px;">🎨 자막 스타일:</label>
                                <select id="subtitle-style-select" style="width: 100%; padding: 8px; background: #0d1520; color: #f0f4f8; border: 1px solid #2a3f5f; border-radius: 5px; font-size: 13px;">
                                    <option value="standard">📝 표준 (균형잡힌 설명)</option>
                                    <option value="comic">😂 코믹 (유머러스하고 재미있게)</option>
                                    <option value="serious">🎯 진지 (격식있고 진중하게)</option>
                                    <option value="dramatic">🎭 드라마틱 (감정적이고 극적으로)</option>
                                    <option value="thrilling">⚡ 긴장감 (스릴있고 박진감있게)</option>
                                    <option value="emotional">💝 감성적 (따뜻하고 감동적으로)</option>
                                    <option value="mysterious">🔮 미스터리 (신비롭고 궁금증 유발)</option>
                                    <option value="energetic">🔥 에너제틱 (활기차고 역동적으로)</option>
                                </select>
                            </div>

                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button id="generate-subtitle-with-gpt" class="sync-btn" style="flex: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: bold;">
                                    🤖 GPT로 자막 생성 요청
                                </button>
                            </div>

                            <!-- GPT 생성 자막 붙여넣기 영역 -->
                            <div id="gpt-subtitle-paste-area" style="display: none; margin-top: 15px; padding: 15px; background: #0d1520; border-radius: 5px; border: 2px dashed #667eea;">
                                <label style="color: #667eea; font-weight: bold; display: block; margin-bottom: 8px;">📋 GPT 생성 자막 붙여넣기:</label>
                                <textarea id="gpt-subtitle-input" placeholder="GPT가 생성한 SRT 자막을 여기에 붙여넣으세요..."
                                          style="width: 100%; height: 150px; padding: 10px; background: #1a2332; color: #f0f4f8; border: 1px solid #2a3f5f; border-radius: 5px; font-family: monospace; font-size: 12px; resize: vertical;"></textarea>
                                <div style="display: flex; gap: 10px; margin-top: 10px;">
                                    <button id="apply-gpt-subtitle" class="sync-btn" style="flex: 1; background: #4CAF50; color: white; font-weight: bold;">
                                        ✅ 자막 트랙에 적용
                                    </button>
                                    <button id="close-paste-area" class="sync-btn" style="background: #666; color: white;">
                                        ❌ 닫기
                                    </button>
                                </div>
                            </div>

                            <small style="display: block; color: #b0c4d0; margin-top: 5px;">
                                💡 입력한 제목은 영상 메타데이터로 저장되며, 자막 트랙에 불러올 수 있습니다.
                            </small>
                        </div>

                        <div class="sync-controls">
                            <button class="sync-btn" id="create-output-video" style="background-color: #FF6F00; color: white; font-weight: bold;">🎬 영상 출력 파일 만들기</button>
                            <button class="sync-btn" id="save-track-project" style="background-color: #00B894; color: white; font-weight: bold;">💾 트랙 프로젝트 저장하기</button>
                            <button class="sync-btn" id="load-track-project" style="background-color: #0984E3; color: white; font-weight: bold;">📂 트랙 프로젝트 불러오기</button>
                        </div>

                        <!-- 영상 출력 진행률 표시 -->
                        <div id="output-video-progress" style="display: none; margin-top: 15px; padding: 15px; background: #1a2332; border-radius: 8px; border: 1px solid #2a3f5f;">
                            <div style="margin-bottom: 8px; color: #f0f4f8; font-weight: bold;" id="output-progress-message">영상 출력 준비 중...</div>
                            <div style="background: #0d1520; height: 24px; border-radius: 12px; overflow: hidden; position: relative;">
                                <div id="output-progress-bar" style="background: linear-gradient(90deg, #FF6F00, #FF8F00); height: 100%; width: 0%; transition: width 0.3s ease; display: flex; align-items: center; justify-content: center;">
                                    <span id="output-progress-percent" style="color: #fff; font-weight: bold; font-size: 12px;"></span>
                                </div>
                            </div>
                        </div>

                        <div class="sync-controls" style="margin-top: 10px;">
                            <button class="sync-btn debug" id="debug-waveform" style="background-color: #ff6b4a;">🔧 파형 디버그</button>
                            <button class="sync-btn test" id="test-real-waveform" style="background-color: #4CAF50;">🎵 실제 파형 테스트</button>
                            <button class="sync-btn test" id="test-subtitle-numbers" style="background-color: #FF6B4A;">🧪 자막 번호 테스트</button>
                            <button class="sync-btn test" id="force-test-subtitles" style="background-color: #9C27B0;">🎯 강제 자막 표시</button>
                            <button class="sync-btn test" id="clear-subtitles" style="background-color: #F44336;">🗑️ 자막 지우기</button>
                            <button class="sync-btn test" id="clear-tracks" style="background-color: #E91E63;">🧹 트랙 지우기</button>
                        </div>
                    </div>

                    <div class="control-section">
                        <h4>🔇 부분 묵음 처리</h4>
                        <div class="silence-editor">
                            <div class="silence-regions" id="silence-regions">
                                <p class="placeholder">비디오를 선택하면 묵음 구간이 표시됩니다</p>
                            </div>
                            <div class="silence-controls">
                                <button class="control-btn" id="add-silence">➕ 묵음 구간 추가</button>
                                <button class="control-btn" id="remove-silence">➖ 묵음 구간 제거</button>
                                <button class="control-btn" id="replace-audio">🔄 다른 음성으로 교체</button>
                                <input type="file" id="replacement-audio-input" accept="audio/*" style="display:none">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 🖊️ 텍스트 오버레이 탭 -->
            <div class="tab-content" id="text-overlay-tab">
                <div class="text-edit-controls">
                    <div class="control-section">
                        <h4>🗑️ 영상 글자 지우기</h4>
                        <div class="text-removal">
                            <div class="video-canvas-container">
                                <canvas id="video-canvas" width="800" height="450"></canvas>
                                <div class="overlay-controls">
                                    <button class="overlay-btn" id="select-text-region">🎯 텍스트 영역 선택</button>
                                    <button class="overlay-btn" id="auto-detect-text">🤖 자동 텍스트 감지</button>
                                    <button class="overlay-btn" id="remove-text">🗑️ 선택 텍스트 제거</button>
                                </div>
                            </div>

                            <div class="text-regions">
                                <h5>📋 감지된 텍스트 영역</h5>
                                <div class="regions-list" id="detected-text-regions">
                                    <p class="placeholder">텍스트 영역을 선택하거나 자동 감지를 실행하세요</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="control-section">
                        <h4>➕ 새 텍스트 추가</h4>
                        <div class="text-addition">
                            <div class="text-input-area">
                                <textarea id="new-text-content" placeholder="추가할 텍스트 입력..."></textarea>
                                <div class="text-timing">
                                    <label>⏰ 시작 시간: <input type="number" id="text-start-time" step="0.1" value="0">초</label>
                                    <label>⏱️ 지속 시간: <input type="number" id="text-duration" step="0.1" value="3">초</label>
                                </div>
                            </div>

                            <div class="text-styling">
                                <h5>🎨 텍스트 스타일</h5>
                                <div class="style-controls">
                                    <div class="style-group">
                                        <label>📝 폰트:</label>
                                        <select id="text-font">
                                            <option value="Arial">Arial</option>
                                            <option value="나눔고딕">나눔고딕</option>
                                            <option value="맑은고딕">맑은고딕</option>
                                        </select>
                                    </div>

                                    <div class="style-group">
                                        <label>📏 크기:</label>
                                        <input type="range" id="text-size" min="12" max="72" value="24">
                                        <span id="size-display">24px</span>
                                    </div>

                                    <div class="style-group">
                                        <label>🎨 색상:</label>
                                        <input type="color" id="text-color" value="#ffffff">
                                    </div>
                                </div>
                            </div>

                            <button class="add-text-btn" id="add-text-overlay">➕ 텍스트 추가</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ⚖️ 비교 분석 탭 -->
            <div class="tab-content" id="compare-tab">
                <div class="compare-setup">
                    <div class="compare-source">
                        <h4>📄 원본 SRT</h4>
                        <select id="original-srt">
                            <option value="">SRT 파일을 선택하세요...</option>
                        </select>
                    </div>

                    <div class="compare-target">
                        <h4>🔄 음성 인식 결과</h4>
                        <select id="generated-srt">
                            <option value="">생성된 SRT 파일을 선택하세요...</option>
                        </select>
                    </div>

                    <button class="analyze-btn primary" id="start-comparison">📊 비교 분석</button>
                </div>

                <div class="compare-results" id="comparison-results" style="display: none;">
                    <div class="comparison-stats">
                        <div class="stat-comparison">
                            <div class="stat-item original">
                                <h5>📄 원본</h5>
                                <span class="value" id="original-subtitle-count">- 개 자막</span>
                                <span class="detail" id="original-details">-, - 개 겹침</span>
                            </div>
                            <div class="stat-divider">⚖️</div>
                            <div class="stat-item generated">
                                <h5>🔄 생성됨</h5>
                                <span class="value" id="generated-subtitle-count">- 개 자막</span>
                                <span class="detail" id="generated-details">-, 갭 없음</span>
                            </div>
                        </div>
                    </div>

                    <div class="side-by-side-comparison">
                        <div class="comparison-pane">
                            <h5>📄 원본 SRT</h5>
                            <div class="subtitle-list original" id="original-subtitle-list"></div>
                        </div>
                        <div class="comparison-pane">
                            <h5>🔄 음성 인식 결과</h5>
                            <div class="subtitle-list generated" id="generated-subtitle-list"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 분석 결과 영역 -->
    <section class="panel results-panel">
        <h2>📈 분석 결과</h2>
        <div class="results-layout">
            <div class="progress-section">
                <h3>⏳ 진행 상황</h3>
                <div class="overall-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="overall-progress-fill" style="width: 0%"></div>
                    </div>
                    <span class="progress-text" id="overall-progress-text">준비 중...</span>
                </div>
                <div class="task-queue" id="task-queue">
                    <div class="empty-state">진행 중인 작업이 없습니다</div>
                </div>
            </div>

            <div class="visualization-section">
                <h3>📊 결과 시각화</h3>
                <div class="chart-container" id="chart-container">
                    <p class="placeholder">분석을 시작하면 결과가 여기에 표시됩니다.</p>
                </div>
            </div>

            <div class="actions-section">
                <h3>🚀 결과 활용</h3>
                <div class="action-buttons">
                    <div class="subtitle-load-controls" style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="action-btn secondary" id="load-subtitle-from-results" style="background-color: #3498db;">📋 자막 불러오기</button>
                        <button class="action-btn secondary" id="load-translator-from-results" style="background-color: #2196F3;">🌐 번역기 자막 불러오기</button>
                    </div>
                    <div class="reinterpret-mode-select">
                        <label>
                            재해석 실행 모드
                            <select id="reinterpret-mode">
                                <option value="api" selected>API 모드 (서버에서 직접 처리)</option>
                                <option value="chatgpt">ChatGPT 창 모드 (새 창에서 질문)</option>
                            </select>
                        </label>
                        <small class="mode-hint">※ ChatGPT 창 모드는 Devtools/GPT와 직접 대화하여 결과를 붙여넣는 방식입니다.</small>
                    </div>
                    <div class="reinterpret-controls">
                        <label for="reinterpret-tone" class="reinterpret-controls-label">재해석 톤</label>
                        <div class="reinterpret-control-row">
                            <select id="reinterpret-tone">
                                <option value="neutral" selected>표준</option>
                                <option value="comic">코믹</option>
                                <option value="dramatic">드라마틱</option>
                                <option value="serious">진중</option>
                                <option value="thrilling">긴장감</option>
                            </select>
                            <button class="action-btn secondary reinterpret-trigger" id="reinterpret-results">🔄 재해석</button>
                        </div>
                    </div>
                    <div class="save-controls">
                        <input type="text" id="save-results-name" placeholder="저장할 이름을 입력하세요" maxlength="60">
                        <button class="action-btn secondary" id="save-report">💾 결과 저장</button>
                    </div>
                    <div class="action-btn-group">
                        <button class="action-btn secondary" id="import-results">📚 저장 결과 불러오기</button>
                        <button class="action-btn primary" id="export-results">📁 결과 내보내기</button>
                        <button class="action-btn secondary" id="open-timeline-translation">🈯 타임라인 번역 편집</button>
                        <button class="action-btn secondary" id="open-timeline">🎬 타임라인 편집기</button>
                        <button class="action-btn outline" id="clear-results">🗑️ 결과 지우기</button>
                    </div>
                </div>
                <div class="saved-results-panel" id="saved-results-panel" style="display: none;">
                    <div class="saved-results-header">
                        <h3>📚 저장된 결과</h3>
                        <button class="action-btn small" id="close-saved-results">닫기</button>
                    </div>
                    <div class="saved-results-list" id="saved-results-list">
                        <div class="empty-state">저장된 결과가 없습니다.</div>
                    </div>
                    <div class="saved-results-footer">
                        <div class="saved-results-actions">
                            <button class="action-btn secondary" id="upload-result-button">📂 파일 불러오기</button>
                            <button class="action-btn outline" id="clear-saved-results">🧹 전체 삭제</button>
                        </div>
                        <input type="file" id="import-results-input" accept="application/json" style="display: none;">
                    </div>
                </div>
            </div>
        </div>
        <div class="reinterpretation-panel" id="reinterpretation-panel" style="display: none;">
            <div class="reinterpretation-header">
                <h3>🔄 재해석 결과</h3>
                <button class="action-btn small" id="hide-reinterpretation">닫기</button>
            </div>
            <div class="reinterpretation-content" id="reinterpretation-text">
                재해석 결과가 여기에 표시됩니다.
            </div>
            <div class="reinterpretation-actions">
                <button class="action-btn secondary" id="copy-reinterpretation">📋 복사</button>
            </div>
        </div>

        <!-- 음성과 배경음악 분리 섹션 -->
        <div class="vocal-separation-section" style="margin-top: 20px; padding: 20px; background: #1a2332; border-radius: 8px; border: 1px solid #2a3f5f;">
            <h3>🎵 음성과 배경음악 분리</h3>

            <div class="separation-controls" style="margin-top: 15px;">
                <div class="control-group">
                    <label style="color: #f0f4f8; font-weight: 500; margin-bottom: 5px; display: block;">
                        음성 파일 선택
                    </label>
                    <button class="action-btn secondary" id="select-separation-audio" style="width: 100%; text-align: left; justify-content: flex-start; padding: 10px;">
                        📁 음성 파일 선택하기
                    </button>
                    <div id="selected-separation-audio" style="margin-top: 8px; padding: 8px; background: #0d1520; border-radius: 5px; color: #4CAF50; font-size: 13px; display: none;">
                        선택된 파일: <span id="separation-audio-name">없음</span>
                    </div>
                    <input type="hidden" id="separation-audio-path" value="">
                </div>

                <div class="control-group" style="margin-top: 15px;">
                    <label for="separation-model-select">
                        분리 모델
                        <select id="separation-model-select" style="width: 100%; padding: 8px; margin-top: 5px; background: #0d1520; color: #f0f4f8; border: 1px solid #2a3f5f; border-radius: 5px;">
                            <option value="htdemucs" selected>HTDemucs (기본, 균형잡힌 품질)</option>
                            <option value="htdemucs_ft">HTDemucs FT (고품질, 느림)</option>
                            <option value="mdx">MDX (빠른 처리)</option>
                            <option value="mdx_extra">MDX Extra (최고 품질, 매우 느림)</option>
                        </select>
                    </label>
                </div>

                <button class="action-btn primary" id="start-separation" style="width: 100%; margin-top: 15px;">🎵 분리 시작</button>

                <div class="separation-info" style="margin-top: 15px; padding: 10px; background: #0d1520; border-radius: 5px;">
                    <p style="margin: 0 0 5px 0; color: #b0c4d0; font-size: 13px;"><strong>ℹ️ 안내:</strong></p>
                    <ul style="margin: 0; padding-left: 20px; color: #b0c4d0; font-size: 12px;">
                        <li>음성(vocals)과 배경음악(accompaniment)을 AI로 분리합니다</li>
                        <li>처리 시간은 파일 길이와 모델에 따라 다릅니다 (보통 1-5분)</li>
                        <li>결과는 원본 폴더의 "separated" 디렉토리에 저장됩니다</li>
                    </ul>
                </div>
            </div>

            <!-- 분리 진행률 -->
            <div id="separation-progress" style="display: none; margin-top: 15px; padding: 15px; background: #0d1520; border-radius: 5px;">
                <h4 style="margin: 0 0 10px 0; color: #f0f4f8;">⏳ 분리 진행 중...</h4>
                <div class="progress-bar" style="background: #2a3f5f; height: 24px; border-radius: 12px; overflow: hidden;">
                    <div id="separation-progress-fill" style="background: linear-gradient(90deg, #4CAF50, #8BC34A); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                </div>
                <p id="separation-progress-text" style="margin: 10px 0 0 0; color: #b0c4d0; font-size: 12px;">AI 모델을 로드하는 중...</p>
            </div>

            <!-- 분리 결과 -->
            <div id="separation-results" style="display: none; margin-top: 15px;">
                <h4 style="color: #f0f4f8;">✅ 분리 완료</h4>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
                    <!-- 음성 결과 -->
                    <div style="padding: 15px; background: #0d1520; border-radius: 5px;">
                        <h5 style="margin: 0 0 10px 0; color: #4CAF50;">🎤 음성 (Vocals)</h5>
                        <div style="font-size: 12px; color: #b0c4d0; margin-bottom: 10px;">
                            <p style="margin: 3px 0;"><strong>파일명:</strong> <span id="vocals-filename">-</span></p>
                            <p style="margin: 3px 0;"><strong>크기:</strong> <span id="vocals-size">-</span></p>
                            <p style="margin: 3px 0;"><strong>길이:</strong> <span id="vocals-duration">-</span></p>
                        </div>
                        <audio id="vocals-player" controls style="width: 100%; margin-bottom: 10px;"></audio>
                        <div style="display: flex; gap: 8px;">
                            <button class="action-btn small" id="load-vocals-file" style="flex: 1; padding: 6px; font-size: 12px;">🎵 음성 파일 로드</button>
                            <button class="action-btn small" id="open-vocals-folder" style="flex: 1; padding: 6px; font-size: 12px;">📂 폴더 열기</button>
                        </div>
                    </div>

                    <!-- 배경음악 결과 -->
                    <div style="padding: 15px; background: #0d1520; border-radius: 5px;">
                        <h5 style="margin: 0 0 10px 0; color: #2196F3;">🎹 배경음악 (Accompaniment)</h5>
                        <div style="font-size: 12px; color: #b0c4d0; margin-bottom: 10px;">
                            <p style="margin: 3px 0;"><strong>파일명:</strong> <span id="accompaniment-filename">-</span></p>
                            <p style="margin: 3px 0;"><strong>크기:</strong> <span id="accompaniment-size">-</span></p>
                            <p style="margin: 3px 0;"><strong>길이:</strong> <span id="accompaniment-duration">-</span></p>
                        </div>
                        <audio id="accompaniment-player" controls style="width: 100%; margin-bottom: 10px;"></audio>
                        <div style="display: flex; gap: 8px;">
                            <button class="action-btn small" id="load-accompaniment-file" style="flex: 1; padding: 6px; font-size: 12px;">🎵 배경음악 로드</button>
                            <button class="action-btn small" id="open-accompaniment-folder" style="flex: 1; padding: 6px; font-size: 12px;">📂 폴더 열기</button>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 10px; text-align: center;">
                    <button class="action-btn secondary" id="separate-another">🔄 다른 파일 분리</button>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- 하단 고정 상태바 -->
<div class="status-bar">
    <div class="status-info">
        <span id="status-text">✅ 준비됨</span>
        <span class="separator">|</span>
        <span id="file-count">📄 파일 0개 선택</span>
        <span class="separator">|</span>
        <span id="analysis-status">⏳ 분석 대기 중</span>
    </div>
    <div class="status-actions">
        <button class="quick-action" id="select-all">✅ 전체 선택</button>
        <button class="quick-action" id="clear-selection">❌ 선택 해제</button>
    </div>
</div>

<!-- 번역기 프로젝트 선택 모달 -->
<div id="translator-project-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
    <div style="background: #2a2a2a; padding: 30px; border-radius: 10px; max-width: 600px; max-height: 80vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.5);">
        <h3 style="color: #fff; margin-bottom: 20px;">🌐 번역기 프로젝트 선택</h3>
        <div id="translator-project-list" style="margin-bottom: 20px;"></div>
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button id="translator-modal-file-btn" style="padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">📁 파일 선택</button>
            <button id="translator-modal-cancel-btn" style="padding: 10px 20px; background: #666; color: white; border: none; border-radius: 5px; cursor: pointer;">취소</button>
        </div>
    </div>
</div>

<!-- 분석 대상 저장 목록 모달 -->
<div id="analysis-target-load-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
    <div style="background: #2a2a2a; padding: 30px; border-radius: 10px; max-width: 600px; max-height: 80vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.5);">
        <h3 style="color: #fff; margin-bottom: 20px;">📂 저장된 분석 대상 목록</h3>
        <div id="saved-targets-list" style="margin-bottom: 20px; max-height: 400px; overflow-y: auto;">
            <!-- 저장된 목록이 여기에 표시됩니다 -->
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button id="load-modal-cancel-btn" style="padding: 10px 20px; background: #666; color: white; border: none; border-radius: 5px; cursor: pointer;">취소</button>
        </div>
    </div>
</div>

<!-- 저장된 제목 선택 모달 -->
<div id="saved-title-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
    <div style="background: #2a2a2a; padding: 30px; border-radius: 10px; max-width: 700px; max-height: 80vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.5);">
        <h3 style="color: #fff; margin-bottom: 20px;">📺 저장된 영상 제목 선택</h3>
        <div style="margin-bottom: 20px;">
            <label style="color: #f0f4f8; display: block; margin-bottom: 8px;">자막 트랙 선택:</label>
            <select id="title-track-type" style="width: 100%; padding: 10px; background: #1a2332; color: #f0f4f8; border: 1px solid #2a3f5f; border-radius: 5px;">
                <option value="main">📝 메인 자막</option>
                <option value="translation">🌐 번역 자막</option>
                <option value="description">🔊 설명 자막</option>
            </select>
        </div>
        <div id="saved-titles-list" style="margin-bottom: 20px; max-height: 400px; overflow-y: auto;">
            <!-- 저장된 제목 목록이 여기에 표시됩니다 -->
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button id="title-modal-cancel-btn" style="padding: 10px 20px; background: #666; color: white; border: none; border-radius: 5px; cursor: pointer;">취소</button>
        </div>
    </div>
</div>

<script src="/static/analysis.js?v=42"></script>
</body>
</html>
