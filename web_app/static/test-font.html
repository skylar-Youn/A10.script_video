<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¼ë³¸ì–´ í°íŠ¸ í…ŒìŠ¤íŠ¸</title>
    <style>
        @font-face {
            font-family: 'Noto Sans JP Local';
            src: url('/static/fonts/NotoSansJP-Regular.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }

        body {
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }

        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #2d3748;
            border-radius: 8px;
        }

        .test-text {
            font-size: 36px;
            margin: 10px 0;
        }

        #canvas-test {
            border: 2px solid #4a5568;
            margin-top: 20px;
            background: white;
        }

        .font-list {
            background: #16213e;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ì¼ë³¸ì–´ í°íŠ¸ í…ŒìŠ¤íŠ¸</h1>

    <div class="test-section">
        <h2>1. HTML í…ìŠ¤íŠ¸ ë Œë”ë§</h2>
        <div class="test-text" style="font-family: 'Noto Sans JP Local', sans-serif;">
            "é¢ç™½ã„çŒ«ã¨çŠ¬å¤§ãƒãƒˆãƒ«ï¼"<br>
            ğŸ± çŒ«ã¨çŠ¬ã®æˆ¦äº‰! ğŸ˜±<br>
            ç¬‘ã„ã¨é©šãã«æº€ã¡ãŸæ˜ åƒ
        </div>
    </div>

    <div class="test-section">
        <h2>2. Canvas í…ìŠ¤íŠ¸ ë Œë”ë§</h2>
        <canvas id="canvas-test" width="800" height="200"></canvas>
    </div>

    <div class="test-section">
        <h2>3. ë¡œë“œëœ í°íŠ¸ í™•ì¸</h2>
        <div class="font-list" id="font-list">ë¡œë”© ì¤‘...</div>
    </div>

    <div class="test-section">
        <h2>4. í°íŠ¸ íŒŒì¼ ì§ì ‘ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testFontFile()">í°íŠ¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ í…ŒìŠ¤íŠ¸</button>
        <div id="font-file-result"></div>
    </div>

    <script>
        // Canvas í…ŒìŠ¤íŠ¸
        async function testCanvas() {
            console.log('Canvas í…ŒìŠ¤íŠ¸ ì‹œì‘...');

            // í°íŠ¸ ë¡œë”© ëŒ€ê¸°
            await document.fonts.ready;
            console.log('âœ… document.fonts.ready ì™„ë£Œ');

            const canvas = document.getElementById('canvas-test');
            const ctx = canvas.getContext('2d');

            // ë°°ê²½
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, 800, 200);

            // ì¼ë³¸ì–´ í…ìŠ¤íŠ¸ ë Œë”ë§
            const testTexts = [
                { text: '"é¢ç™½ã„çŒ«ã¨çŠ¬å¤§ãƒãƒˆãƒ«ï¼"', y: 50, font: '"Noto Sans JP Local", sans-serif' },
                { text: 'ğŸ± çŒ«ã¨çŠ¬ã®æˆ¦äº‰! ğŸ˜±', y: 100, font: '"Noto Sans JP Local", sans-serif' },
                { text: 'ç¬‘ã„ã¨é©šãã«æº€ã¡ãŸæ˜ åƒ', y: 150, font: '"Noto Sans JP Local", sans-serif' }
            ];

            testTexts.forEach(({ text, y, font }) => {
                ctx.font = `bold 36px ${font}`;
                ctx.textAlign = 'left';
                ctx.textBaseline = 'middle';

                // ì™¸ê³½ì„ 
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 4;
                ctx.strokeText(text, 20, y);

                // ì±„ìš°ê¸°
                ctx.fillStyle = '#000000';
                ctx.fillText(text, 20, y);

                console.log(`ë Œë”ë§ ì™„ë£Œ: ${text}`);
            });
        }

        // ë¡œë“œëœ í°íŠ¸ ëª©ë¡ í‘œì‹œ
        async function listLoadedFonts() {
            await document.fonts.ready;

            const loadedFonts = [];
            for (const font of document.fonts) {
                loadedFonts.push(`${font.family} (${font.style}, ${font.weight}) - ${font.status}`);
            }

            const fontListDiv = document.getElementById('font-list');
            if (loadedFonts.length > 0) {
                fontListDiv.innerHTML = loadedFonts.join('<br>');
            } else {
                fontListDiv.innerHTML = 'ë¡œë“œëœ ì»¤ìŠ¤í…€ í°íŠ¸ ì—†ìŒ';
            }

            console.log('ë¡œë“œëœ í°íŠ¸:', loadedFonts);
        }

        // í°íŠ¸ íŒŒì¼ ì§ì ‘ í…ŒìŠ¤íŠ¸
        async function testFontFile() {
            const resultDiv = document.getElementById('font-file-result');
            resultDiv.innerHTML = 'í…ŒìŠ¤íŠ¸ ì¤‘...';

            try {
                const response = await fetch('/static/fonts/NotoSansJP-Regular.ttf');
                const blob = await response.blob();

                resultDiv.innerHTML = `
                    âœ… í°íŠ¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì„±ê³µ!<br>
                    - ìƒíƒœ: ${response.status} ${response.statusText}<br>
                    - í¬ê¸°: ${(blob.size / 1024 / 1024).toFixed(2)} MB<br>
                    - íƒ€ì…: ${blob.type}
                `;

                console.log('í°íŠ¸ íŒŒì¼ ì •ë³´:', {
                    status: response.status,
                    size: blob.size,
                    type: blob.type
                });
            } catch (error) {
                resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
                console.error('í°íŠ¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('load', async () => {
            console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            await testCanvas();
            await listLoadedFonts();
        });

        // í°íŠ¸ ë¡œë“œ ìƒíƒœ ëª¨ë‹ˆí„°ë§
        document.fonts.addEventListener('loadingdone', (event) => {
            console.log('í°íŠ¸ ë¡œë”© ì™„ë£Œ:', event);
            event.fontfaces.forEach(font => {
                console.log(`- ${font.family}: ${font.status}`);
            });
        });

        document.fonts.addEventListener('loadingerror', (event) => {
            console.error('í°íŠ¸ ë¡œë”© ì‹¤íŒ¨:', event);
        });
    </script>
</body>
</html>
