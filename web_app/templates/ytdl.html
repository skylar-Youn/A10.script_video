<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>유튜브 다운로드 도구</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="container">
    <header class="header">
        <h1>유튜브 다운로드 도구</h1>
        <nav class="nav-links">
            <a href="/ytdl" class="nav-link {% if nav_active == 'ytdl' %}active{% endif %}">⬇️ 다운로드 도구</a>
            <a href="/text-removal" class="nav-link {% if nav_active == 'text_removal' %}active{% endif %}">🧽 영상에서 글자 지우기</a>
            <a href="/video-analyzer" class="nav-link {% if nav_active == 'video_analyzer' %}active{% endif %}">📹 영상 분석기</a>
            <a href="/analysis" class="nav-link">📊 영상메이커</a>
            <a href="/" class="nav-link">🏠 AI 쇼츠 메이커</a>
            <a href="/similarity" class="nav-link {% if nav_active == 'similarity' %}active{% endif %}">🎞️ 영상 유사도 검사</a>
            <a href="/copyright" class="nav-link {% if nav_active == 'copyright' %}active{% endif %}">🛡️ 저작권 검사</a>
        </nav>
    </header>

    <section class="panel">
        <h2>다운로드 설정</h2>
        <form id="ytdl-form" method="post" action="/ytdl" class="ytdl-form">
            <div class="field">
                <label for="urls">유튜브 URL (여러 줄 입력 가능)</label>
                <textarea id="urls" name="urls" rows="4">{{ form_values.urls }}</textarea>
            </div>
            <div class="field inline">
                <label for="output_dir">저장 폴더</label>
                <input type="text" id="output_dir" name="output_dir" placeholder="현재 디렉터리" value="{{ form_values.output_dir }}">
                <label for="sub_langs">자막 언어</label>
                <input type="text" id="sub_langs" name="sub_langs" value="{{ form_values.sub_langs }}" placeholder="예: ko,en">
                <label for="sub_format">자막 형식</label>
                <input type="text" id="sub_format" name="sub_format" value="{{ form_values.sub_format }}">
            </div>
            <div class="field inline">
                <label><input type="checkbox" id="download_subs" name="download_subs" {% if form_values.download_subs %}checked{% endif %}> 자막 다운로드</label>
                <label><input type="checkbox" id="auto_subs" name="auto_subs" {% if form_values.auto_subs %}checked{% endif %}> 자동 생성 자막 포함</label>
                <label><input type="checkbox" id="dry_run" name="dry_run" {% if form_values.dry_run %}checked{% endif %}> 드라이런(미리보기)</label>
                <label><input type="checkbox" name="save_settings"> 현재 상태를 기본값으로 저장</label>
            </div>
            <div class="field inline" style="background: rgba(102, 126, 234, 0.1); padding: 10px; border-radius: 5px; border-left: 3px solid #667eea;">
                <label style="color: #aaa; font-weight: 500; margin-right: 15px;">📥 다운로드 시 자동 분리:</label>
                <label><input type="checkbox" id="extract_vocal" name="extract_vocal" {% if form_values.extract_vocal %}checked{% endif %}> 🎤 Vocal</label>
                <label><input type="checkbox" id="extract_instruments" name="extract_instruments" {% if form_values.extract_instruments %}checked{% endif %}> 🎸 Instruments</label>
            </div>
            <button type="submit" id="download-btn">실행</button>
        </form>

        <!-- 진행율 표시 영역 -->
        <div id="progress-container" style="display: none; margin-top: 20px;">
            <div class="progress-header">
                <h3>다운로드 진행 중</h3>
                <span id="progress-status">준비 중...</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar" style="width: 0%;">
                    <span id="progress-text">0%</span>
                </div>
            </div>
            <div id="progress-message" class="progress-message">다운로드를 시작합니다...</div>
        </div>
    </section>

    {% if settings_saved %}
    <div class="alert success">
        현재 설정을 기본값으로 저장했습니다.
    </div>
    {% endif %}

    {% if error %}
    <div class="alert error">
        <strong>오류:</strong> {{ error }}
    </div>
    {% endif %}

    {% if result %}
    <section class="panel">
        <h2>결과</h2>
        <p>
            {% if result.dry_run %}
            다운로드 예정 파일 ({{ result.count }}개)
            {% else %}
            다운로드 완료 파일 ({{ result.count }}개)
            {% endif %}
        </p>
        <p>자막 언어: {{ result.langs | join(", ") }}</p>
        <ul class="file-list">
            {% for item in result.files %}
            <li><code>{{ item }}</code></li>
            {% endfor %}
        </ul>
    </section>
    {% endif %}

    <section class="panel">
        <div class="history-header-controls">
            <h2>다운로드 기록 <span style="font-size: 0.8rem; color: #888; font-weight: 400;">(기존 파일에서 추출)</span></h2>
            <div class="history-actions">
                <button id="load-other-files-btn" class="action-btn" style="background: #2196F3;" onclick="loadOtherFiles()">
                    📁 다른 파일 불러오기
                </button>
                <button id="extract-vocal-btn" class="action-btn" onclick="extractAudio('vocal')" disabled>
                    🎤 Vocal 분리
                </button>
                <button id="extract-instruments-btn" class="action-btn" onclick="extractAudio('instruments')" disabled>
                    🎸 Instruments 분리
                </button>
                <button id="select-all-btn" class="action-btn secondary" onclick="toggleSelectAll()">
                    전체 선택
                </button>
            </div>
        </div>

        <!-- 숨겨진 파일 입력 요소 -->
        <input type="file" id="file-picker" multiple accept="audio/*,video/*,.mp4,.webm,.mkv,.avi,.mov,.wav,.mp3,.m4a,.ogg,.flac" style="display: none;">

        <!-- 추출 진행율 표시 영역 -->
        <div id="extraction-progress-container" style="display: none; margin-bottom: 20px;">
            <div class="progress-header">
                <h3>오디오 추출 진행 중</h3>
                <span id="extraction-progress-status">준비 중...</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="extraction-progress-bar" style="width: 0%;">
                    <span id="extraction-progress-text">0%</span>
                </div>
            </div>
            <div id="extraction-progress-message" class="progress-message">오디오 추출을 시작합니다...</div>
        </div>

        <div id="download-history" class="file-list-container">
            <div class="loading">기록을 불러오는 중...</div>
        </div>
    </section>

    <section class="panel info">
        <h2>사용 팁</h2>
        <ul>
            <li>`자막 언어`에 `ko,en`처럼 콤마로 구분하면 여러 언어를 받을 수 있습니다.</li>
            <li>영상 없이 자막만 확인하려면 `드라이런`을 체크하세요.</li>
            <li>`자동 생성 자막 포함`을 해제하면 업로드된 자막만 내려받습니다.</li>
            <li>상단의 '영상 유사도 검사' 탭에서 폴더 전체 비교와 상세 지표를 확인할 수 있습니다.</li>
        </ul>
    </section>
</div>

<script>
let pollInterval = null;
let extractionPollInterval = null;

// 폼 제출 이벤트 가로채기
document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('ytdl-form');
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        await startDownload();
    });

    // 페이지 로드 시 다운로드 기록 불러오기
    loadDownloadHistory();
});

async function startDownload() {
    // 폼 데이터 수집
    const urls = document.getElementById('urls').value;
    const outputDir = document.getElementById('output_dir').value;
    const subLangs = document.getElementById('sub_langs').value;
    const subFormat = document.getElementById('sub_format').value;
    const downloadSubs = document.getElementById('download_subs').checked;
    const autoSubs = document.getElementById('auto_subs').checked;
    const dryRun = document.getElementById('dry_run').checked;
    const extractVocal = document.getElementById('extract_vocal').checked;
    const extractInstruments = document.getElementById('extract_instruments').checked;

    if (!urls.trim()) {
        alert('최소 하나의 URL을 입력하세요.');
        return;
    }

    // 진행율 UI 표시
    document.getElementById('progress-container').style.display = 'block';
    document.getElementById('download-btn').disabled = true;
    updateProgress(0, '다운로드를 시작합니다...', 'starting');

    try {
        // 백그라운드 다운로드 시작
        const response = await fetch('/api/ytdl/start', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                urls: urls,
                output_dir: outputDir,
                sub_langs: subLangs,
                sub_format: subFormat,
                download_subs: downloadSubs,
                auto_subs: autoSubs,
                dry_run: dryRun,
                extract_vocal: extractVocal,
                extract_instruments: extractInstruments,
            })
        });

        if (!response.ok) {
            throw new Error('다운로드 시작 실패');
        }

        const result = await response.json();
        const taskId = result.task_id;

        // 진행 상태 폴링 시작
        pollProgress(taskId);
    } catch (error) {
        console.error('Error:', error);
        updateProgress(0, '오류 발생: ' + error.message, 'error');
        document.getElementById('download-btn').disabled = false;
    }
}

function pollProgress(taskId) {
    // 기존 폴링 중지
    if (pollInterval) {
        clearInterval(pollInterval);
    }

    // 1초마다 진행 상태 확인
    pollInterval = setInterval(async () => {
        try {
            const response = await fetch(`/api/ytdl/status/${taskId}`);
            if (!response.ok) {
                throw new Error('상태 조회 실패');
            }

            const status = await response.json();
            updateProgress(status.progress, status.message, status.status);

            // 완료되면 폴링 중지
            if (status.completed) {
                clearInterval(pollInterval);
                pollInterval = null;
                document.getElementById('download-btn').disabled = false;

                if (status.status === 'completed') {
                    // 다운로드 기록 새로고침
                    setTimeout(() => {
                        loadDownloadHistory();
                        // 진행율 UI 숨기기 (3초 후)
                        setTimeout(() => {
                            document.getElementById('progress-container').style.display = 'none';
                        }, 3000);
                    }, 1000);
                }
            }
        } catch (error) {
            console.error('폴링 오류:', error);
            clearInterval(pollInterval);
            pollInterval = null;
            updateProgress(0, '상태 확인 실패: ' + error.message, 'error');
            document.getElementById('download-btn').disabled = false;
        }
    }, 1000);
}

function updateProgress(percent, message, status) {
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const progressMessage = document.getElementById('progress-message');
    const progressStatus = document.getElementById('progress-status');

    progressBar.style.width = percent + '%';
    progressText.textContent = Math.round(percent) + '%';
    progressMessage.textContent = message;

    // 상태에 따라 색상 변경
    if (status === 'error') {
        progressBar.style.background = '#ef4444';
        progressStatus.textContent = '❌ 오류';
        progressStatus.style.color = '#ef4444';
    } else if (status === 'completed') {
        progressBar.style.background = '#10b981';
        progressStatus.textContent = '✓ 완료';
        progressStatus.style.color = '#10b981';
    } else if (status === 'downloading') {
        progressBar.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        progressStatus.textContent = '⏬ 다운로드 중';
        progressStatus.style.color = '#667eea';
    } else {
        progressBar.style.background = '#fbbf24';
        progressStatus.textContent = '⏳ 준비 중';
        progressStatus.style.color = '#fbbf24';
    }
}

// Load and display download history
async function loadDownloadHistory() {
    try {
        const response = await fetch('/api/ytdl/history');
        const history = await response.json();
        displayHistory(history);
    } catch (error) {
        document.getElementById('download-history').innerHTML =
            '<div class="alert error">기록을 불러올 수 없습니다: ' + error.message + '</div>';
    }
}

function displayHistory(history) {
    const container = document.getElementById('download-history');

    if (history.length === 0) {
        container.innerHTML = '<div class="info">아직 다운로드 기록이 없습니다.</div>';
        return;
    }

    // 파일 목록을 플랫하게 변환
    const allFiles = [];
    history.forEach((record) => {
        record.files.forEach(filePath => {
            const fileName = filePath.split('/').pop();
            const fileExt = fileName.split('.').pop().toLowerCase();
            const fileSize = ''; // 파일 크기는 서버에서 가져와야 하지만 일단 생략
            const date = new Date(record.timestamp).toLocaleString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });

            // 비디오 파일만 표시 (오디오 분리 가능한 파일)
            const videoExts = ['mp4', 'webm', 'mkv', 'avi', 'mov'];
            if (videoExts.includes(fileExt)) {
                allFiles.push({
                    path: filePath,
                    name: fileName,
                    ext: fileExt,
                    size: fileSize,
                    date: date,
                    icon: getFileIcon(fileExt)
                });
            }
        });
    });

    if (allFiles.length === 0) {
        container.innerHTML = '<div class="info">다운로드된 비디오 파일이 없습니다.</div>';
        return;
    }

    let html = '<div class="file-grid">';
    allFiles.forEach((file, index) => {
        html += `
            <div class="file-card" data-file-path="${file.path}">
                <div class="file-checkbox">
                    <input type="checkbox" id="file-${index}" class="file-select"
                           data-file-path="${file.path}" onchange="updateActionButtons()">
                </div>
                <div class="file-icon">
                    ${file.icon}
                </div>
                <div class="file-info">
                    <div class="file-name" title="${file.name}">${file.name}</div>
                    <div class="file-meta">
                        <span class="file-date">${file.date}</span>
                    </div>
                </div>
                <div class="file-actions">
                    <button class="file-action-btn" onclick="deleteFile('${file.path.replace(/'/g, "\\'")}')">
                        🗑️ 삭제
                    </button>
                </div>
            </div>
        `;
    });
    html += '</div>';

    container.innerHTML = html;
}

function getFileIcon(ext) {
    const icons = {
        'mp4': '🎬',
        'webm': '🎬',
        'mkv': '🎬',
        'avi': '🎬',
        'mov': '🎬',
        'wav': '🎵',
        'mp3': '🎵'
    };
    return icons[ext] || '📄';
}

function updateActionButtons() {
    const checkboxes = document.querySelectorAll('.file-select:checked');
    const vocalBtn = document.getElementById('extract-vocal-btn');
    const instrumentsBtn = document.getElementById('extract-instruments-btn');

    if (checkboxes.length > 0) {
        vocalBtn.disabled = false;
        instrumentsBtn.disabled = false;
    } else {
        vocalBtn.disabled = true;
        instrumentsBtn.disabled = true;
    }
}

function toggleSelectAll() {
    const checkboxes = document.querySelectorAll('.file-select');
    const selectAllBtn = document.getElementById('select-all-btn');
    const allChecked = Array.from(checkboxes).every(cb => cb.checked);

    checkboxes.forEach(cb => {
        cb.checked = !allChecked;
    });

    selectAllBtn.textContent = allChecked ? '전체 선택' : '선택 해제';
    updateActionButtons();
}

async function extractAudio(type) {
    const checkboxes = document.querySelectorAll('.file-select:checked');
    const filePaths = Array.from(checkboxes).map(cb => cb.dataset.filePath);

    if (filePaths.length === 0) {
        alert('파일을 선택해주세요.');
        return;
    }

    if (!confirm(`선택한 ${filePaths.length}개 파일에서 ${type === 'vocal' ? 'Vocal' : 'Instruments'}을 추출하시겠습니까?`)) {
        return;
    }

    // 진행율 UI 표시
    document.getElementById('extraction-progress-container').style.display = 'block';
    document.getElementById('extract-vocal-btn').disabled = true;
    document.getElementById('extract-instruments-btn').disabled = true;
    updateExtractionProgress(0, '오디오 추출을 시작합니다...', 'starting');

    try {
        const response = await fetch('/api/ytdl/extract-audio', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                file_paths: filePaths,
                extract_vocal: type === 'vocal',
                extract_instruments: type === 'instruments'
            })
        });

        if (!response.ok) {
            throw new Error('오디오 추출 시작 실패');
        }

        const result = await response.json();
        const taskId = result.task_id;

        // 진행 상태 폴링 시작
        pollExtractionProgress(taskId);
    } catch (error) {
        console.error('Error:', error);
        updateExtractionProgress(0, '오류 발생: ' + error.message, 'error');
        document.getElementById('extract-vocal-btn').disabled = false;
        document.getElementById('extract-instruments-btn').disabled = false;
    }
}

function pollExtractionProgress(taskId) {
    // 기존 폴링 중지
    if (extractionPollInterval) {
        clearInterval(extractionPollInterval);
    }

    // 1초마다 진행 상태 확인
    extractionPollInterval = setInterval(async () => {
        try {
            const response = await fetch(`/api/ytdl/extract-audio/status/${taskId}`);
            if (!response.ok) {
                throw new Error('상태 조회 실패');
            }

            const status = await response.json();
            updateExtractionProgress(status.progress, status.message, status.status);

            // 완료되면 폴링 중지
            if (status.completed) {
                clearInterval(extractionPollInterval);
                extractionPollInterval = null;

                // 버튼 다시 활성화 (체크된 항목이 있으면)
                updateActionButtons();

                if (status.status === 'completed') {
                    // 다운로드 기록 새로고침
                    setTimeout(() => {
                        loadDownloadHistory();
                        // 진행율 UI 숨기기 (3초 후)
                        setTimeout(() => {
                            document.getElementById('extraction-progress-container').style.display = 'none';
                        }, 3000);
                    }, 1000);
                }
            }
        } catch (error) {
            console.error('폴링 오류:', error);
            clearInterval(extractionPollInterval);
            extractionPollInterval = null;
            updateExtractionProgress(0, '상태 확인 실패: ' + error.message, 'error');
            updateActionButtons();
        }
    }, 1000);
}

function updateExtractionProgress(percent, message, status) {
    const progressBar = document.getElementById('extraction-progress-bar');
    const progressText = document.getElementById('extraction-progress-text');
    const progressMessage = document.getElementById('extraction-progress-message');
    const progressStatus = document.getElementById('extraction-progress-status');

    progressBar.style.width = percent + '%';
    progressText.textContent = Math.round(percent) + '%';
    progressMessage.textContent = message;

    // 상태에 따라 색상 변경
    if (status === 'error') {
        progressBar.style.background = '#ef4444';
        progressStatus.textContent = '❌ 오류';
        progressStatus.style.color = '#ef4444';
    } else if (status === 'completed') {
        progressBar.style.background = '#10b981';
        progressStatus.textContent = '✓ 완료';
        progressStatus.style.color = '#10b981';
    } else if (status === 'extracting') {
        progressBar.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        progressStatus.textContent = '🎵 추출 중';
        progressStatus.style.color = '#667eea';
    } else {
        progressBar.style.background = '#fbbf24';
        progressStatus.textContent = '⏳ 준비 중';
        progressStatus.style.color = '#fbbf24';
    }
}

async function deleteFile(filePath) {
    if (!confirm('이 파일을 삭제하시겠습니까?')) {
        return;
    }

    try {
        const response = await fetch('/api/ytdl/files', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify([filePath])
        });

        const result = await response.json();

        if (result.errors && result.errors.length > 0) {
            alert('파일 삭제 중 오류가 발생했습니다:\n' + result.errors.join('\n'));
        } else {
            alert('파일이 삭제되었습니다.');
        }

        loadDownloadHistory();
    } catch (error) {
        alert('파일 삭제 중 오류가 발생했습니다: ' + error.message);
    }
}

async function deleteFiles(recordIndex, filePaths) {
    if (!confirm('선택한 파일들을 삭제하시겠습니까?')) {
        return;
    }

    try {
        const response = await fetch('/api/ytdl/files', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(filePaths)
        });

        const result = await response.json();

        if (result.errors && result.errors.length > 0) {
            alert('일부 파일 삭제 중 오류가 발생했습니다:\n' + result.errors.join('\n'));
        } else {
            alert(`${result.deleted.length}개 파일이 삭제되었습니다.`);
        }

        // Reload history to reflect changes
        loadDownloadHistory();
    } catch (error) {
        alert('파일 삭제 중 오류가 발생했습니다: ' + error.message);
    }
}

// 다른 파일 불러오기
function loadOtherFiles() {
    const filePicker = document.getElementById('file-picker');

    // 파일 선택 이벤트 리스너 설정 (중복 방지를 위해 기존 리스너 제거)
    filePicker.onchange = handleFileSelection;

    // 파일 선택 대화상자 열기
    filePicker.click();
}

async function handleFileSelection(event) {
    const files = event.target.files;

    if (files.length === 0) {
        return;
    }

    // 파일 업로드 진행 상태 표시
    const uploadStatus = document.createElement('div');
    uploadStatus.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.95);
        padding: 30px;
        border-radius: 10px;
        border: 2px solid #667eea;
        z-index: 10000;
        min-width: 300px;
        text-align: center;
    `;
    uploadStatus.innerHTML = `
        <h3 style="margin: 0 0 15px 0;">파일 업로드 중</h3>
        <div style="color: #888;">파일을 업로드하고 있습니다...</div>
        <div style="margin-top: 15px;">
            <div style="width: 100%; height: 20px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden;">
                <div id="upload-progress" style="width: 0%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); transition: width 0.3s;"></div>
            </div>
            <div id="upload-count" style="margin-top: 10px; color: #888; font-size: 0.9rem;">0 / ${files.length}</div>
        </div>
    `;
    document.body.appendChild(uploadStatus);

    const progressBar = document.getElementById('upload-progress');
    const countDisplay = document.getElementById('upload-count');

    try {
        let uploadedCount = 0;
        const uploadedFiles = [];

        // 파일을 하나씩 업로드
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/api/ytdl/upload-file', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`파일 업로드 실패: ${file.name}`);
                }

                const result = await response.json();
                uploadedFiles.push(result.file_path);
                uploadedCount++;

                // 진행률 업데이트
                const progress = (uploadedCount / files.length) * 100;
                progressBar.style.width = progress + '%';
                countDisplay.textContent = `${uploadedCount} / ${files.length}`;
            } catch (error) {
                console.error(`파일 업로드 오류 (${file.name}):`, error);
            }
        }

        // 업로드 완료
        document.body.removeChild(uploadStatus);

        if (uploadedFiles.length > 0) {
            alert(`${uploadedFiles.length}개 파일이 성공적으로 추가되었습니다.`);
            // 다운로드 기록 새로고침하여 업로드된 파일 표시
            loadDownloadHistory();
        } else {
            alert('파일 업로드에 실패했습니다.');
        }
    } catch (error) {
        document.body.removeChild(uploadStatus);
        alert('파일 업로드 중 오류가 발생했습니다: ' + error.message);
    }

    // 파일 입력 초기화
    event.target.value = '';
}
</script>

<style>
/* 파일 리스트 컨테이너 */
.file-list-container {
    background: #000;
    border-radius: 8px;
    padding: 20px;
    min-height: 200px;
}

.history-header-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.history-actions {
    display: flex;
    gap: 10px;
}

.action-btn {
    padding: 8px 16px;
    border: none;
    border-radius: 5px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.action-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.action-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.action-btn.secondary {
    background: #555;
}

.action-btn.secondary:hover {
    background: #666;
    box-shadow: 0 4px 12px rgba(85, 85, 85, 0.4);
}

/* 파일 그리드 */
.file-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

/* 파일 카드 */
.file-card {
    display: flex;
    align-items: center;
    gap: 15px;
    background: #1a1a1a;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 15px;
    transition: all 0.2s;
}

.file-card:hover {
    background: #252525;
    border-color: #444;
    transform: translateX(5px);
}

.file-checkbox {
    flex-shrink: 0;
}

.file-checkbox input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.file-icon {
    font-size: 32px;
    flex-shrink: 0;
}

.file-info {
    flex: 1;
    min-width: 0;
}

.file-name {
    font-size: 14px;
    font-weight: 500;
    color: #e0e0e0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 5px;
}

.file-meta {
    display: flex;
    gap: 15px;
    font-size: 12px;
    color: #888;
}

.file-actions {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
}

.file-action-btn {
    padding: 6px 12px;
    border: none;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
    background: #dc3545;
    color: white;
}

.file-action-btn:hover {
    background: #c82333;
    transform: scale(1.05);
}

.loading {
    text-align: center;
    color: #888;
    font-style: italic;
    padding: 40px;
}

.info {
    text-align: center;
    color: #888;
    font-style: italic;
    padding: 40px;
}

/* 진행율 표시 스타일 */
#progress-container {
    background: rgba(0, 0, 0, 0.2);
    padding: 20px;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.progress-header h3 {
    margin: 0;
    font-size: 1.2rem;
    color: #e0e6ed;
}

#progress-status {
    font-weight: 600;
    font-size: 1rem;
}

.progress-bar-container {
    width: 100%;
    height: 30px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 10px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.progress-bar {
    height: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: width 0.3s ease;
    border-radius: 15px;
}

#progress-text {
    color: white;
    font-weight: 600;
    font-size: 0.9rem;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

.progress-message {
    color: #c8d8e8;
    font-size: 0.95rem;
    text-align: center;
    margin-top: 10px;
}

#download-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

</style>

</body>
</html>
