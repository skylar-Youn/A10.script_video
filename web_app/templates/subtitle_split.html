<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìë§‰ ë¶„ë¦¬ ë„êµ¬</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="container">
    <header class="header">
        <h1>ìë§‰ ë¶„ë¦¬ ë„êµ¬</h1>
        <nav class="nav-links">
            <a href="/ytdl" class="nav-link {% if nav_active == 'ytdl' %}active{% endif %}">â¬‡ï¸ ë‹¤ìš´ë¡œë“œ ë„êµ¬</a>
            <a href="/text-removal" class="nav-link {% if nav_active == 'text_removal' %}active{% endif %}">ğŸ§½ ì˜ìƒì—ì„œ ê¸€ì ì§€ìš°ê¸°</a>
            <a href="/subtitle-split" class="nav-link {% if nav_active == 'subtitle_split' %}active{% endif %}">âœ‚ï¸ ìë§‰ë¶„ë¦¬ í•˜ê¸°</a>
            <a href="/analysis" class="nav-link">ğŸ“Š ë¶„ì„ ë„êµ¬</a>
            <a href="/" class="nav-link">ğŸ  AI ì‡¼ì¸  ë©”ì´ì»¤</a>
            <a href="/similarity" class="nav-link {% if nav_active == 'similarity' %}active{% endif %}">ğŸï¸ ì˜ìƒ ìœ ì‚¬ë„ ê²€ì‚¬</a>
            <a href="/copyright" class="nav-link {% if nav_active == 'copyright' %}active{% endif %}">ğŸ›¡ï¸ ì €ì‘ê¶Œ ê²€ì‚¬</a>
        </nav>
    </header>

    <section class="panel">
        <h2>ìë§‰ íŒŒì¼ ì—…ë¡œë“œ</h2>
        <p class="panel-sub">SRT ë˜ëŠ” VTT íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ê° ìë§‰ ë¸”ë¡ì„ ì‹œê°„ ì •ë³´ì™€ í•¨ê»˜ ë¶„ë¦¬í•´ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
        <form method="post" enctype="multipart/form-data" class="subtitle-form">
            <div class="field">
                <label for="subtitle_file">ìë§‰ íŒŒì¼ ì„ íƒ (SRT / VTT)</label>
                <input type="file" id="subtitle_file" name="subtitle_file" accept=".srt,.vtt" required>
            </div>
            <div class="field inline">
                <label><input type="checkbox" name="remove_empty" checked> ë¹ˆ ì¤„/ê³µë°± ìë§‰ ì œê±°</label>
            </div>
            <button type="submit">ìë§‰ ë¶„ë¦¬í•˜ê¸°</button>
        </form>
    </section>

    {% if error %}
    <div class="alert error">
        <strong>ì˜¤ë¥˜:</strong> {{ error }}
    </div>
    {% endif %}

    {% if show_results %}
    <section class="panel subtitle-results">
        <h2>ë¶„ë¦¬ ê²°ê³¼</h2>
        <p class="panel-sub">
            ì´ <strong>{{ summary.count }}</strong>ê°œì˜ ìë§‰ ë¸”ë¡{% if summary.original_filename %} ({{ summary.original_filename }}){% endif %}
            {% if summary.converted %}<span class="hint-text">* VTT â†’ SRT ìë™ ë³€í™˜</span>{% endif %}
        </p>

        <div class="export-block">
            <div class="export-header">
                <h3>í…ìŠ¤íŠ¸ ë‚´ë³´ë‚´ê¸°</h3>
                <div class="export-actions">
                    <button type="button" class="btn-secondary" data-copy-target="plain-text-output">í…ìŠ¤íŠ¸ ë³µì‚¬</button>
                    <button type="button" class="btn-secondary" data-download-target="plain-text-output" data-filename="subtitle_split.txt">TXT ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>
            <textarea id="plain-text-output" readonly rows="10">{{ plain_text }}</textarea>
        </div>

        <details class="advanced">
            <summary>CSV í˜•ì‹ ë¯¸ë¦¬ë³´ê¸°</summary>
            <div class="export-block">
                <div class="export-header">
                    <h3>CSV ë°ì´í„°</h3>
                    <div class="export-actions">
                        <button type="button" class="btn-secondary" data-copy-target="csv-output">CSV ë³µì‚¬</button>
                        <button type="button" class="btn-secondary" data-download-target="csv-output" data-filename="subtitle_split.csv">CSV ë‹¤ìš´ë¡œë“œ</button>
                    </div>
                </div>
                <textarea id="csv-output" readonly rows="8">{{ csv_preview }}</textarea>
            </div>
        </details>

        <div class="subtitle-table-wrapper">
            <table class="subtitle-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>ì‹œì‘</th>
                        <th>ì¢…ë£Œ</th>
                        <th>ìë§‰ ë‚´ìš©</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in split_result %}
                    <tr>
                        <td>{{ entry.index }}</td>
                        <td>{{ entry.start }}</td>
                        <td>{{ entry.end }}</td>
                        <td>
                            {% for line in entry.text_lines %}
                                {{ line }}{% if not loop.last %}<br>{% endif %}
                            {% endfor %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
    {% endif %}
</div>

<script>
const copyButtons = document.querySelectorAll('[data-copy-target]');
copyButtons.forEach(btn => {
    if (!btn.dataset.originalLabel) {
        btn.dataset.originalLabel = btn.textContent;
    }
    btn.addEventListener('click', () => {
        const targetId = btn.dataset.copyTarget;
        const textarea = document.getElementById(targetId);
        if (!textarea) return;
        textarea.focus();
        textarea.select();
        document.execCommand('copy');
        textarea.setSelectionRange(0, 0);
        textarea.blur();
        btn.textContent = 'ë³µì‚¬ ì™„ë£Œ!';
        setTimeout(() => btn.textContent = btn.dataset.originalLabel, 1200);
    });
});

const downloadButtons = document.querySelectorAll('[data-download-target]');
downloadButtons.forEach(btn => {
    btn.addEventListener('click', () => {
        const targetId = btn.dataset.downloadTarget;
        const textarea = document.getElementById(targetId);
        if (!textarea) return;
        const blob = new Blob([textarea.value], { type: 'text/plain;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = btn.dataset.filename || 'subtitle_split.txt';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    });
});
</script>
</body>
</html>
