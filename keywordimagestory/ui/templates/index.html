{% extends 'base.html' %}

{% block content %}
<section>
  <hgroup>
    <h1>Keyword Image Story Studio</h1>
    <p>키워드 기반 스토리 생성 · 자막/음성/장면 동시 편집 · 템플릿 & 효과 적용</p>
  </hgroup>
  <p>
    <a href="{{ url_for('tools_ui') }}" class="secondary">프롬프트 도구 모음 페이지 →</a>
  </p>
  <form id="project-form">
    <div class="grid">
      <label>
        선택한 툴 결과
        <select id="tool-selection" name="tool_selection">
          <option value="">선택하세요</option>
          <option value="story_keywords">스토리 키워드</option>
          <option value="image_story">이미지 스토리</option>
          <option value="shorts_script">쇼츠 대본 & 이미지</option>
          <option value="shorts_scenes">쇼츠 대본 & 영상</option>
          <option value="video_import">가져온 영상</option>
        </select>
      </label>
      <label>
        저장된 결과 선택
        <select id="record-selection" name="record_selection" disabled>
          <option value="">저장된 결과를 먼저 로드하세요</option>
        </select>
      </label>
    </div>
    <button type="submit" class="contrast">선택 프로젝트 생성</button>
  </form>
</section>

<section id="project-state">
  <div class="placeholder">
    <p>프로젝트를 생성하면 여기에서 모든 상태를 확인할 수 있습니다.</p>
  </div>
</section>

<section class="history-section">
  <div class="history-header">
    <h2>📚 최근 작업 내역</h2>
    <p>이전에 작업한 프로젝트들을 확인하고 다시 불러올 수 있습니다.</p>
  </div>

  <div class="history-container">
    {% if history %}
      <div class="history-grid">
        {% for item in history %}
        <article class="history-card" data-project-id="{{ item.project_id }}" data-version="{{ item.version }}">
          <header class="history-card-header">
            <div class="project-info">
              <h3 class="project-title">{{ item.project_id }}</h3>
              <span class="project-version">v{{ item.version }}</span>
            </div>
            <div class="card-actions">
              <button type="button" class="action-btn reload-btn" title="프로젝트 다시 열기">
                🔄
              </button>
              <button type="button" class="action-btn delete-btn" data-delete-history title="삭제">
                🗑️
              </button>
            </div>
          </header>

          <div class="history-card-body">
            <p class="project-description">{{ item.summary or '설명 없음' }}</p>
            <div class="project-meta">
              <div class="meta-item">
                <span class="meta-icon">⏰</span>
                <span class="meta-text">{{ item.timestamp.strftime('%m월 %d일 %H:%M') }}</span>
              </div>
              <div class="meta-item">
                <span class="meta-icon">📅</span>
                <span class="meta-text">{{ item.timestamp.strftime('%Y년') }}</span>
              </div>
            </div>
          </div>

          <footer class="history-card-footer">
            <div class="project-tags">
              <span class="project-tag">프로젝트</span>
            </div>
            <button type="button" class="open-project-btn contrast" title="프로젝트 열기">
              열기 →
            </button>
          </footer>
        </article>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        <div class="empty-icon">📝</div>
        <h3>아직 작업 내역이 없습니다</h3>
        <p>새 프로젝트를 생성하면 여기에 표시됩니다.</p>
        <a href="{{ url_for('tools_ui') }}" class="contrast">첫 프로젝트 만들기 →</a>
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}
