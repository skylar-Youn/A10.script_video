{% extends 'base.html' %}

{% block content %}
<section class="tools-header">
  <hgroup>
    <h1>🛠️ 스토리 제작 도구 모음</h1>
    <p>1~4번 프롬프트 워크플로를 한 페이지에서 실행하세요. 각 섹션은 OpenAI API와 연결되어 바로 결과를 제공합니다.</p>
  </hgroup>
  <nav class="tools-nav">
    <a href="{{ url_for('root') }}" class="secondary">← 메인 스튜디오로 돌아가기</a>
  </nav>
</section>

<div class="tools-container">

  <!-- Tool 1: 스토리 키워드 -->
  <section class="tool-section">
    <article class="tool-card keyword-tool">
      <header class="tool-header">
        <div class="tool-icon">📝</div>
        <div class="tool-info">
          <h2>1. 스토리를 위한 키워드</h2>
          <p>간단한 스토리 키워드를 입력하면 30개의 창의적인 제목 후보를 생성합니다.</p>
        </div>
      </header>

      <div class="tool-content">
        <form id="story-keyword-form" class="tool-form">
          <div class="mode-selection">
            <label>실행 모드
              <select name="mode" id="keyword-mode">
                <option value="api" selected>API 모드 (서버에서 직접 처리)</option>
                <option value="chatgpt">ChatGPT 창 모드 (새 창에서 ChatGPT 실행)</option>
              </select>
            </label>
          </div>
          <div class="input-group">
            <label>스토리 키워드
              <input type="text" name="keyword" required placeholder="예: 달빛 여행" />
            </label>
          </div>
          <div class="form-controls">
            <label>언어
              <select name="language">
                <option value="ko" selected>한국어</option>
                <option value="en">English</option>
                <option value="ja">日본語</option>
              </select>
            </label>
            <label>생성 개수
              <input type="number" name="count" min="5" max="60" step="5" value="30" />
            </label>
          </div>
          <div class="form-actions">
            <button type="submit" class="contrast">키워드 생성</button>
            <button type="button" data-save="story_keywords" class="outline">결과 저장</button>
            <button type="button" data-refresh="story_keywords" class="secondary">새로고침</button>
          </div>
        </form>

        <div class="results-section">
          <div id="story-keyword-results" class="tool-results">
            <div class="placeholder">
              <p>키워드를 입력한 뒤 결과를 확인하세요.</p>
            </div>
          </div>

          <div class="saved-results" id="story-keyword-saved">
            <h3>💾 저장된 키워드 목록</h3>
            <div class="saved-body">
              <div class="placeholder"><p>저장된 결과가 없습니다.</p></div>
            </div>
          </div>
        </div>
      </div>
    </article>
  </section>

  <!-- Tool 2: 이미지 스토리 -->
  <section class="tool-section">
    <article class="tool-card image-tool">
      <header class="tool-header">
        <div class="tool-icon">🖼️</div>
        <div class="tool-info">
          <h2>2. 이미지 기반 제목 & 씬 묘사 생성</h2>
          <p>이미지를 업로드하거나 설명을 입력하면 서로 다른 제목과 장면용 이미지 묘사를 생성합니다.</p>
        </div>
      </header>

      <div class="tool-content">
        <form id="image-story-form" class="tool-form" enctype="multipart/form-data">
          <div class="mode-selection">
            <label>실행 모드
              <select name="mode" id="image-mode">
                <option value="api" selected>API 모드 (서버에서 직접 처리)</option>
                <option value="chatgpt">ChatGPT 창 모드 (새 창에서 ChatGPT 실행)</option>
              </select>
            </label>
          </div>
          <div class="input-group">
            <label>대표 키워드 (선택)
              <input type="text" name="keyword" placeholder="예: 달빛 여행">
            </label>
          </div>
          <div class="upload-section">
            <label class="file-upload-label">이미지 업로드
              <input type="file" name="image" accept="image/*">
              <span class="file-help">📎 이미지 파일을 선택하세요</span>
            </label>
            <label>이미지 설명 (선택)
              <textarea name="image_description" rows="3" placeholder="이미지에서 보이는 요소나 분위기를 설명하세요."></textarea>
            </label>
          </div>
          <div class="form-controls">
            <label>생성 개수
              <input type="number" name="count" min="3" max="24" step="1" value="8">
            </label>
            <div class="help-text">
              <small>💡 이미지 또는 설명 중 하나 이상을 입력하세요.</small>
            </div>
          </div>
          <div class="form-actions">
            <button type="submit" class="contrast">제목 & 묘사 생성</button>
            <button type="button" data-save="image_story" class="outline">결과 저장</button>
            <button type="button" data-refresh="image_story" class="secondary">새로고침</button>
          </div>
        </form>

        <div class="results-section">
          <div id="image-story-results" class="tool-results">
            <div class="placeholder"><p>생성 결과가 여기에 표시됩니다.</p></div>
          </div>

          <div class="saved-results" id="image-story-saved">
            <h3>💾 저장된 이미지 스토리</h3>
            <div class="saved-body">
              <div class="placeholder"><p>저장된 결과가 없습니다.</p></div>
            </div>
          </div>
        </div>
      </div>
    </article>
  </section>

  <!-- Tool 3: 쇼츠 대본 & 이미지 -->
  <section class="tool-section">
    <article class="tool-card script-tool">
      <header class="tool-header">
        <div class="tool-icon">🎬</div>
        <div class="tool-info">
          <h2>3. 쇼츠용 대본 & 이미지 프롬프트</h2>
          <p>스토리 키워드로 60초 분량의 SRT 자막과 장면별 이미지 묘사를 생성합니다.</p>
        </div>
      </header>

      <div class="tool-content">
        <form id="shorts-script-form" class="tool-form">
          <div class="mode-selection">
            <label>실행 모드
              <select name="mode" id="shorts-mode">
                <option value="api" selected>API 모드 (서버에서 직접 처리)</option>
                <option value="chatgpt">ChatGPT 창 모드 (새 창에서 ChatGPT 실행)</option>
              </select>
            </label>
          </div>
          <div class="input-group">
            <label>스토리 키워드
              <input type="text" name="shorts_keyword" required placeholder="예: 빛을 쫓는 도시 사냥꾼">
            </label>
          </div>
          <div class="form-controls">
            <label>언어
              <select name="language">
                <option value="ko" selected>한국어</option>
                <option value="en">English</option>
                <option value="ja">日本語</option>
              </select>
            </label>
          </div>
          <div class="form-actions">
            <button type="button" class="secondary" data-generate-script-english-prompt>영어 프롬프트 생성</button>
            <button type="button" class="secondary" data-generate-script-korean-prompt>한국어 프롬프트 생성</button>
            <button type="submit" class="contrast">대본 생성</button>
            <button type="button" class="secondary" data-import-chatgpt-script>대본 가져오기</button>
          </div>
        </form>

        <div class="prompt-preview" id="script-english-prompt-container" style="margin-top: 1rem;">
          <label style="display: block;">
            영어 프롬프트
            <textarea id="shorts-script-english-prompt" placeholder="버튼을 누르면 영어 프롬프트가 생성됩니다. 필요하면 ChatGPT 결과를 붙여넣어 수정해도 됩니다." style="width: 100%; min-height: 160px; margin-top: 0.5rem; resize: vertical;"></textarea>
          </label>
          <button type="button" class="secondary" data-copy-script-english-prompt style="margin-top: 0.5rem;" disabled>프롬프트 복사</button>
        </div>
        <div class="prompt-preview" id="script-korean-prompt-container" style="margin-top: 1rem;">
          <label style="display: block;">
            한국어 프롬프트
            <textarea id="shorts-script-korean-prompt" placeholder="버튼을 누르면 한국어 프롬프트가 생성됩니다." style="width: 100%; min-height: 140px; margin-top: 0.5rem; resize: vertical;"></textarea>
          </label>
          <button type="button" class="secondary" data-copy-script-korean-prompt style="margin-top: 0.5rem;" disabled>프롬프트 복사</button>
        </div>

        <div class="advanced-actions">
          <div class="action-group">
            <h4>🔧 고급 기능</h4>
          <div class="action-buttons">
            <button type="button" data-tts="shorts_script" class="outline">🎤 음성 변환</button>
            <button type="button" data-continue="shorts_script" data-continue-mode="story" class="outline">➕ 스토리 이어서 생성</button>
            <button type="button" data-continue="shorts_script" data-continue-mode="image" class="outline">➕ 이미지 이어서 생성</button>
            <button type="button" data-load-video="shorts_script" class="outline">🎞️ 영상 불러오기</button>
            <button type="button" data-preview="shorts_script" class="outline">👀 미리보기</button>
          </div>
        </div>
          <div class="action-group">
            <h4>🖼️ 영상에서 이미지 자르기</h4>
            <div class="action-buttons">
              <button type="button" data-preview-trim-image="shorts_script" data-trim-image-mode="start" class="outline">앞 이미지 보기</button>
              <button type="button" data-preview-trim-image="shorts_script" data-trim-image-mode="current" class="outline">현재 이미지 보기</button>
              <button type="button" data-preview-trim-image="shorts_script" data-trim-image-mode="end" class="outline">뒤 이미지 보기</button>
            </div>
            <div class="action-buttons" style="margin-top: 0.5rem;">
              <button type="button" data-extract-frames="shorts_script" data-interval="10" class="outline">⏱️ 10초 간격 자르기</button>
              <button type="button" data-view-extracted-frames="shorts_script" class="outline">📁 자른 이미지 보기</button>
            </div>
          </div>
          <div class="action-group">
            <div class="action-buttons">
              <button type="button" data-save="shorts_script" class="contrast">결과 저장</button>
              <button type="button" data-refresh="shorts_script" class="secondary">새로고침</button>
            </div>
          </div>
        </div>

        <div class="results-section">
          <div id="shorts-script-results" class="tool-results script-results">
            <div class="placeholder"><p>생성된 SRT 자막과 이미지 프롬프트가 여기에 나타납니다.</p></div>
          </div>

          <div id="shorts-script-audio" class="audio-result">
            <div class="placeholder"><p>자막 음성 변환 결과가 여기에 표시됩니다.</p></div>
          </div>

          <div class="saved-results" id="shorts-script-saved">
            <h3>💾 저장된 쇼츠 대본</h3>
            <div class="saved-body">
              <div class="placeholder"><p>저장된 결과가 없습니다.</p></div>
            </div>
          </div>
        </div>
      </div>
    </article>
  </section>

  <!-- Tool 4: 쇼츠 대본 & 영상 -->
  <section class="tool-section">
    <article class="tool-card scene-tool">
      <header class="tool-header">
        <div class="tool-icon">🎥</div>
        <div class="tool-info">
          <h2>4. 쇼츠용 대본 & 영상 장면 프롬프트</h2>
          <p>키워드를 기반으로 [씬 #] 태그가 포함된 대본과 카메라/분위기 설명을 제공합니다.</p>
        </div>
      </header>

      <div class="tool-content">
        <form id="shorts-scenes-form" class="tool-form">
          <div class="mode-selection">
            <label>실행 모드
              <select name="mode" id="scenes-mode">
                <option value="api" selected>API 모드 (서버에서 직접 처리)</option>
                <option value="chatgpt">ChatGPT 창 모드 (새 창에서 ChatGPT 실행)</option>
              </select>
            </label>
          </div>
          <div class="input-group">
            <label>스토리 키워드
              <input type="text" name="scenes_keyword" required placeholder="예: 시간여행 탐정">
            </label>
          </div>
          <div class="form-controls">
            <label>언어
              <select name="language">
                <option value="ko" selected>한국어</option>
                <option value="en">English</option>
                <option value="ja">日본語</option>
              </select>
            </label>
          </div>
          <div class="form-actions">
            <button type="button" class="secondary" data-generate-english-prompt>영어 프롬프트 생성</button>
            <button type="button" class="secondary" data-generate-korean-prompt>한국어 프롬프트 생성</button>
            <button type="submit" class="contrast">장면 생성</button>
          </div>
        </form>

        <div class="prompt-preview" id="scenes-english-prompt-container" style="margin-top: 1rem;">
          <label style="display: block;">
            영어 프롬프트
            <textarea id="shorts-scenes-english-prompt" placeholder="버튼을 누르면 영어 프롬프트가 생성됩니다. 필요하면 ChatGPT 결과를 붙여넣어 수정해도 됩니다." style="width: 100%; min-height: 160px; margin-top: 0.5rem; resize: vertical;"></textarea>
          </label>
          <button type="button" class="secondary" data-copy-english-prompt style="margin-top: 0.5rem;" disabled>프롬프트 복사</button>
        </div>
        <div class="prompt-preview" id="scenes-korean-prompt-container" style="margin-top: 1rem;">
          <label style="display: block;">
            한국어 프롬프트
            <textarea id="shorts-scenes-korean-prompt" placeholder="버튼을 누르면 한국어 프롬프트가 생성됩니다." style="width: 100%; min-height: 140px; margin-top: 0.5rem; resize: vertical;"></textarea>
          </label>
          <button type="button" class="secondary" data-copy-korean-prompt style="margin-top: 0.5rem;" disabled>프롬프트 복사</button>
        </div>

        <div class="advanced-actions">
          <div class="action-group">
            <h4>🔧 고급 기능</h4>
          <div class="action-buttons">
            <button type="button" data-tts="shorts_scenes" class="outline">🎤 음성 변환</button>
            <button type="button" data-continue="shorts_scenes" data-continue-mode="story" class="outline">➕ 스토리 이어서 생성</button>
            <button type="button" data-continue="shorts_scenes" data-continue-mode="image" class="outline">➕ 영상 이어서 생성</button>
            <button type="button" data-load-video="shorts_scenes" class="outline">🎞️ 영상 불러오기</button>
            <button type="button" data-preview="shorts_scenes" class="outline">👀 미리보기</button>
          </div>
        </div>
          <div class="action-group">
            <h4>🖼️ 영상에서 이미지 자르기</h4>
            <div class="action-buttons">
              <button type="button" data-preview-trim-image="shorts_scenes" data-trim-image-mode="start" class="outline">앞 이미지 보기</button>
              <button type="button" data-preview-trim-image="shorts_scenes" data-trim-image-mode="current" class="outline">현재 이미지 보기</button>
              <button type="button" data-preview-trim-image="shorts_scenes" data-trim-image-mode="end" class="outline">뒤 이미지 보기</button>
            </div>
            <div class="action-buttons" style="margin-top: 0.5rem;">
              <button type="button" data-extract-frames="shorts_scenes" data-interval="10" class="outline">⏱️ 10초 간격 자르기</button>
              <button type="button" data-view-extracted-frames="shorts_scenes" class="outline">📁 자른 이미지 보기</button>
            </div>
          </div>
          <div class="action-group">
            <div class="action-buttons">
              <button type="button" data-save="shorts_scenes" class="contrast">결과 저장</button>
              <button type="button" data-refresh="shorts_scenes" class="secondary">새로고침</button>
            </div>
          </div>
        </div>

        <div class="results-section">
          <div id="shorts-scenes-results" class="tool-results scene-results">
            <div class="placeholder"><p>생성된 SRT 대본과 영상 장면 설명이 여기에 표시됩니다.</p></div>
          </div>

          <div id="shorts-scenes-audio" class="audio-result">
            <div class="placeholder"><p>자막 음성 변환 결과가 여기에 표시됩니다.</p></div>
          </div>

          <div class="saved-results" id="shorts-scenes-saved">
            <h3>💾 저장된 영상 장면 프롬프트</h3>
            <div class="saved-body">
              <div class="placeholder"><p>저장된 결과가 없습니다.</p></div>
            </div>
          </div>
        </div>
      </div>
    </article>
  </section>

  <!-- Tool 5: 자막과 영상 해설, 영상 가져오기 -->
  <section class="tool-section">
    <article class="tool-card import-tool">
      <header class="tool-header">
        <div class="tool-icon">📹</div>
        <div class="tool-info">
          <h2>5. 자막과 영상 해설, 영상 가져오기</h2>
          <p>YouTube 다운로드 서버에서 자막과 영상을 가져와 프로젝트에 등록합니다.</p>
        </div>
      </header>

      <div class="tool-content">
        <form id="video-import-form" class="tool-form">
          <div class="mode-selection">
            <label>다운로드 서버
              <select name="server" id="import-server">
                <option value="8003" selected>http://127.0.0.1:8003 (YouTube 다운로드)</option>
              </select>
            </label>
          </div>

          <div class="import-options">
            <button type="button" id="fetch-downloads" class="secondary">다운로드 목록 새로고침</button>
            <div id="download-list" class="download-list">
              <div class="placeholder"><p>다운로드 목록을 불러오려면 '새로고침' 버튼을 클릭하세요.</p></div>
            </div>
          </div>

          <div class="selected-import">
            <label>선택된 파일
              <select name="selected_file" id="selected-file" disabled>
                <option value="">파일을 선택하세요</option>
              </select>
            </label>
          </div>

          <div class="form-controls">
            <button type="submit" class="import-btn">자막과 영상 가져오기</button>
            <button type="button" id="save-video-import-btn" class="save-btn" disabled>결과 저장</button>
            <button type="button" class="refresh-btn secondary">새로고침</button>
          </div>
        </form>

        <div class="tool-results">
          <div id="video-import-result" class="import-result">
            <div class="placeholder"><p>가져온 자막과 영상이 여기에 표시됩니다.</p></div>
          </div>

          <div class="saved-results" id="video-import-saved">
            <h3>💾 가져온 영상 목록</h3>
            <div class="saved-body" id="video-import-saved-body">
              <div class="placeholder"><p>가져온 영상이 없습니다.</p></div>
            </div>
          </div>
        </div>
      </div>
    </article>
  </section>

  <!-- Tool 6: 글 작성 & 대본 만들기 -->
  <section class="tool-section">
    <article class="tool-card writing-tool">
      <header class="tool-header">
        <div class="tool-icon">✍️</div>
        <div class="tool-info">
          <h2>6. 글 작성하기 &amp; 대본 만들기</h2>
          <p>자유롭게 대본을 작성하거나 붙여넣고, ChatGPT 창과 연동해 빠르게 결과를 다듬어 보세요.</p>
        </div>
      </header>

      <div class="tool-content">
        <form id="long-script-form" class="tool-form">
          <div class="mode-selection">
            <label>실행 모드
              <select name="mode" id="long-script-mode">
                <option value="api" selected>API 모드 (서버에서 직접 처리)</option>
                <option value="chatgpt">ChatGPT 창 모드 (새 창에서 ChatGPT 열기)</option>
              </select>
            </label>
          </div>

          <div class="input-group">
            <label>콘텐츠 주제
              <input type="text" name="script_topic" placeholder="예: 인공지능 트렌드 요약">
            </label>
            <button type="button" class="contrast" data-generate-long-script-inline style="margin-top: 0.5rem;">대본 생성</button>
          </div>

          <div class="form-controls">
            <label>언어
              <select name="script_language">
                <option value="ko" selected>한국어</option>
                <option value="en">English</option>
                <option value="ja">日本語</option>
              </select>
            </label>
          </div>

          <div class="form-controls" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
            <label>파트 선택
              <select name="part_number" id="part-number-select">
                <option value="1">1부</option>
                <option value="2">2부</option>
                <option value="3">3부</option>
                <option value="4">4부</option>
                <option value="5">5부</option>
              </select>
            </label>
            <label>파트 길이
              <select name="part_duration" id="part-duration-select">
                <option value="1">1분</option>
                <option value="2" selected>2분</option>
                <option value="3">3분</option>
                <option value="5">5분</option>
                <option value="10">10분</option>
              </select>
            </label>
          </div>

          <div class="form-actions" style="margin-bottom: 1rem;">
            <button type="button" class="contrast" data-generate-part-all style="font-size: 1.1rem; font-weight: 600;">
              🎬 선택한 파트 생성 (대본 + 영상 + 이미지)
            </button>
          </div>

          <div class="editor-section">
            <label>대본 편집 공간
              <textarea id="long-script-editor" name="script_body" rows="16" placeholder="여기에 대본을 작성하거나 붙여넣으세요. 필요하면 직접 편집하면서 사용할 수 있습니다."></textarea>
            </label>
          </div>

          <div class="form-actions">
            <button type="submit" class="secondary">대본 업데이트</button>
            <button type="button" class="secondary" data-copy-long-script>대본 복사</button>
            <button type="button" class="outline" data-generate-media-prompts>🎨 이미지/영상 프롬프트 생성</button>
            <button type="button" data-save="long_script" class="outline">결과 저장</button>
            <button type="button" data-refresh="long_script" class="secondary">새로고침</button>
          </div>
        </form>

        <div class="chatgpt-import-section" data-chatgpt-import-section style="display: none;">
          <div class="chatgpt-import-hint">
            <p>ChatGPT에서 생성된 대본을 아래 입력창에 붙여넣고 <strong>결과 반영</strong> 버튼을 눌러 편집 공간으로 가져오세요.</p>
          </div>
          <label>ChatGPT 결과 붙여넣기
            <textarea id="long-script-chatgpt-input" rows="10" placeholder="ChatGPT에서 생성한 대본을 여기에 붙여넣으세요."></textarea>
          </label>
          <div class="chatgpt-import-actions">
            <button type="button" class="outline" data-process-chatgpt-long-script>결과 반영</button>
            <button type="button" class="secondary" data-clear-chatgpt-long-script>초기화</button>
          </div>
        </div>

        <div class="results-section">
          <div id="long-script-results" class="tool-results long-script-results">
            <div class="placeholder"><p>대본을 작성한 뒤 '대본 업데이트' 버튼을 클릭하면 여기에서 미리보기와 저장 옵션을 확인할 수 있습니다.</p></div>
          </div>

          <div id="media-prompts-results" class="tool-results media-prompts-results" style="display: none; margin-top: 2rem;">
            <h3>🎨 생성된 이미지/영상 프롬프트</h3>
            <div id="media-prompts-container">
              <div class="placeholder"><p>프롬프트를 생성하려면 '이미지/영상 프롬프트 생성' 버튼을 클릭하세요.</p></div>
            </div>
          </div>

          <div class="saved-results" id="long-script-saved">
            <h3>💾 저장된 대본</h3>
            <div class="saved-body">
              <div class="placeholder"><p>저장된 대본이 없습니다.</p></div>
            </div>
          </div>
        </div>
      </div>
    </article>
  </section>

</div>
{% endblock %}
